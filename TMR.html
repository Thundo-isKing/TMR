<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>TMR ~ Create Your Future</title>
    <style>
        /* Critical: prevent a flash of the desktop header before external CSS/JS loads.
           Default hide, then explicitly show on desktop widths only. */
        .page-header { display: none; }
        @media (min-width: 1025px) { .page-header { display: flex !important; } }
        @media (max-width: 1024px) { .page-header { display: none !important; } }
    </style>
    <link rel="stylesheet" href="TMR.css?v=20260120a">
    <link rel="stylesheet" href="page-transitions.css?v=20260106a">
    <link rel="stylesheet" href="backgrounds.css?v=20251208a">
    <link rel="stylesheet" href="calendar-mobile.css?v=20260121c">
    <script>
        (function () {
            try {
                var raw = localStorage.getItem('tmr_boot_theme');
                if (!raw) {
                    try {
                        var lastUid = (typeof sessionStorage !== 'undefined') ? sessionStorage.getItem('tmr_last_user_id') : null;
                        if (lastUid) {
                            raw = localStorage.getItem('tmr_user_' + lastUid + '_tmr_boot_theme');
                        }
                        if (!raw) raw = localStorage.getItem('tmr_anon_tmr_boot_theme');

                        // If still missing, build a snapshot from the current user's scoped theme keys.
                        if (!raw && lastUid) {
                            var accent2 = localStorage.getItem('tmr_user_' + lastUid + '_theme_accent_color') || localStorage.getItem('tmr_user_' + lastUid + '_tmr_accent') || null;
                            var bg2 = localStorage.getItem('tmr_user_' + lastUid + '_theme_bg_image') || localStorage.getItem('tmr_user_' + lastUid + '_tmr_bg_image') || null;
                            var anim2 = localStorage.getItem('tmr_user_' + lastUid + '_theme_animation') || null;
                            var font2 = localStorage.getItem('tmr_user_' + lastUid + '_theme_font_family') || null;
                            var bold2 = localStorage.getItem('tmr_user_' + lastUid + '_theme_bold_text') || null;
                            if (accent2 || bg2 || anim2 || font2 || bold2) {
                                raw = JSON.stringify({
                                    accentColor: accent2,
                                    backgroundImage: bg2,
                                    animation: anim2,
                                    fontFamily: font2,
                                    boldText: bold2,
                                    updatedAt: Date.now()
                                });
                                try { localStorage.setItem('tmr_boot_theme', raw); } catch (_) {}
                            }
                        }

                        // Anonymous fallback if we have no last user.
                        if (!raw && !lastUid) {
                            var aAccent = localStorage.getItem('tmr_anon_theme_accent_color') || localStorage.getItem('tmr_anon_tmr_accent') || null;
                            var aBg = localStorage.getItem('tmr_anon_theme_bg_image') || localStorage.getItem('tmr_anon_tmr_bg_image') || null;
                            var aAnim = localStorage.getItem('tmr_anon_theme_animation') || null;
                            var aFont = localStorage.getItem('tmr_anon_theme_font_family') || null;
                            var aBold = localStorage.getItem('tmr_anon_theme_bold_text') || null;
                            if (aAccent || aBg || aAnim || aFont || aBold) {
                                raw = JSON.stringify({
                                    accentColor: aAccent,
                                    backgroundImage: aBg,
                                    animation: aAnim,
                                    fontFamily: aFont,
                                    boldText: aBold,
                                    updatedAt: Date.now()
                                });
                                try { localStorage.setItem('tmr_boot_theme', raw); } catch (_) {}
                            }
                        }
                    } catch (_) {}
                }
                if (!raw) return;
                var theme = JSON.parse(raw);
                if (!theme || typeof theme !== 'object') return;

                var root = document.documentElement;

                var accent = (typeof theme.accentColor === 'string') ? theme.accentColor.trim() : '';
                var accentRgb = (typeof theme.accentRgb === 'string') ? theme.accentRgb.trim() : '';
                var bg = (typeof theme.backgroundImage === 'string') ? theme.backgroundImage : '';
                var fontFamily = (typeof theme.fontFamily === 'string') ? theme.fontFamily.trim() : '';
                var boldText = (typeof theme.boldText === 'string') ? theme.boldText.trim() : '';
                var bgVideo = (typeof theme.backgroundVideo === 'string') ? theme.backgroundVideo.trim() : '';

                if (!accent || accent === 'null' || accent === 'undefined') accent = '';
                if (!accentRgb || accentRgb === 'null' || accentRgb === 'undefined') accentRgb = '';
                if (!bg || bg === 'null' || bg === 'undefined') bg = '';
                if (!fontFamily || fontFamily === 'null' || fontFamily === 'undefined') fontFamily = '';
                if (!boldText || boldText === 'null' || boldText === 'undefined') boldText = '';
                if (!bgVideo || bgVideo === 'null' || bgVideo === 'undefined') bgVideo = '';

                // If a live wallpaper is enabled, set the class immediately so we don't
                // flash white before theme-video.js injects/decodes the <video>.
                if (!bgVideo) {
                    try {
                        var lastUid2 = (typeof sessionStorage !== 'undefined') ? sessionStorage.getItem('tmr_last_user_id') : null;
                        if (lastUid2) {
                            bgVideo = localStorage.getItem('tmr_user_' + lastUid2 + '_theme_bg_video') || '';
                        }
                        if (!bgVideo) bgVideo = localStorage.getItem('tmr_anon_theme_bg_video') || '';
                        if (!bgVideo) bgVideo = localStorage.getItem('theme_bg_video') || '';
                    } catch (_) {}
                }
                if (bgVideo) {
                    try {
                        root.classList.add('tmr-has-bg-video');
                        root.classList.add('tmr-bg-video-loading');
                    } catch (_) {}
                }

                // Apply font family if available
                if (fontFamily) {
                    root.style.setProperty('--font-family', fontFamily);
                    document.body.style.fontFamily = fontFamily;
                }

                // Apply bold text if enabled
                if (boldText === 'true') {
                    document.body.style.fontWeight = '600';
                }

                // Resolve --accent-rgb even for non-hex colors (rgb(), hsl(), named colors, etc.)
                if (accent && !accentRgb) {
                    if (accent[0] === '#') {
                        var hex = accent.slice(1);
                        if (hex.length === 3) hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
                        if (/^[0-9a-fA-F]{6}$/.test(hex)) {
                            accentRgb = parseInt(hex.slice(0, 2), 16) + ',' +
                                parseInt(hex.slice(2, 4), 16) + ',' +
                                parseInt(hex.slice(4, 6), 16);
                        }
                    }

                    if (!accentRgb && typeof getComputedStyle === 'function') {
                        try {
                            var probe = document.createElement('span');
                            probe.style.color = accent;
                            probe.style.display = 'none';
                            document.documentElement.appendChild(probe);
                            var computed = getComputedStyle(probe).color;
                            probe.remove();
                            var m = computed && computed.match(/rgba?\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);
                            if (m) accentRgb = m[1] + ',' + m[2] + ',' + m[3];
                        } catch (_) {}
                    }
                }

                if (accent) root.style.setProperty('--accent-color', accent);
                if (accentRgb) root.style.setProperty('--accent-rgb', accentRgb);

                if (bg) {
                    // Avoid injecting a huge CSS rule when bg is a data URL.
                    var safe = bg.replace(/'/g, "\\'");
                    root.style.setProperty('--tmr-boot-bg-image', "url('" + safe + "')");

                    // Optional: hint the browser to fetch the image ASAP (only for normal URLs).
                    if (!/^data:/i.test(bg)) {
                        try {
                            var preload = document.createElement('link');
                            preload.rel = 'preload';
                            preload.as = 'image';
                            preload.href = bg;
                            document.head.appendChild(preload);
                        } catch (_) {}
                    }

                    var style = document.createElement('style');
                    style.id = 'tmr-boot-theme-style';
                    style.textContent = 'html,body{' +
                        'background-image:var(--tmr-boot-bg-image) !important;' +
                        'background-size:cover !important;' +
                        'background-position:center !important;' +
                        'background-repeat:no-repeat !important;' +
                        'background-attachment:fixed !important;' +
                    '}';
                    document.head.appendChild(style);
                }
            } catch (e) {
                // ignore
            }
        })();
    </script>
    <script>
        // Prevent a brief flash of the main app UI before the auth modal is shown.
        // auth-client.js will clear this once it has displayed the correct UI.
        (function () {
            try {
                document.documentElement.classList.add('tmr-auth-pending');

                // Safety: if auth-client fails to load or crashes before clearing,
                // don't leave the entire app permanently hidden.
                setTimeout(function () {
                    try {
                        if (document.documentElement.classList.contains('tmr-auth-pending')) {
                            console.warn('[Auth] Pending timeout; revealing UI');
                            document.documentElement.classList.remove('tmr-auth-pending');
                        }
                    } catch (e) {}
                }, 3500);
            } catch (e) {}
        })();
    </script>
    <style>
        /* Desktop layout rules only (mobile has its own responsive rules below) */
        @media (min-width: 1025px) {
            body {
                height: 100vh;
                overflow: visible !important;
            }

            .calendar-page {
                display: flex;
                flex-direction: row;
                min-height: 100vh;
                gap: 12px;
                width: 100%;
                justify-content: center;
                padding: 12px;
                box-sizing: border-box;
            }

            /* TODO Panel on LEFT - modal-sized (420px) */
            .todo-panel {
                flex: 0 0 420px;
                background: rgba(255, 255, 255, 0.5);
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                display: flex;
                height: 60vh;
                max-height: calc(100vh - 24px);
                overflow: hidden;
                flex-direction: column;
            }

            .todo-panel h3 {
                margin: 0;
                padding: 0;
                font-size: 18px;
                font-weight: 600;
                color: white;
                flex-shrink: 0;
            }

            .todo-panel .todo-input-row {
                padding: 16px;
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
                background: white;
                flex-shrink: 0;
                border-bottom: 1px solid #eee;
            }

            .todo-panel input[type="text"],
            .todo-panel input[type="number"] {
                flex: 1;
                min-width: 150px;
                padding: 10px 12px;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                font-size: 14px;
                transition: border-color 0.2s ease;
            }

            .todo-panel input:focus {
                outline: none;
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 0 0 3px rgba(0,137,241,0.15);
            }

            .todo-panel .todo-list {
                flex: 1;
                overflow-y: auto;
                list-style: none;
                padding: 0 16px 16px 16px;
                margin: 0;
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .todo-panel .todo-item {
                background: linear-gradient(135deg, #f8f9fa, #f0f3f7);
                border: 1px solid #e0e8f0;
                padding: 12px;
                border-radius: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                transition: all 0.2s ease;
            }

            .todo-panel .todo-item:hover {
                background: linear-gradient(135deg, #f0f3f7, #e8ecf2);
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 2px 8px rgba(0,137,241,0.1);
            }

            .todo-panel .small-tmr-btn {
                background: #d7dbdf !important;
                border: none !important;
                color: #333 !important;
                padding: 8px 14px !important;
                border-radius: 8px !important;
                box-shadow: none !important;
                transition: background 0.15s ease !important;
                transform: none !important;
            }

            .todo-panel .small-tmr-btn:hover {
                background: var(--accent-color, #0089f1) !important;
                transform: none !important;
                box-shadow: none !important;
            }

            /* MEIBOT Panel on RIGHT - modal-sized (400px) */
            .meibot-panel {
                flex: 0 0 400px;
                background: rgba(255, 255, 255, 0.5) !important;
                backdrop-filter: blur(12px) !important;
                -webkit-backdrop-filter: blur(12px) !important;
                border-radius: 16px;
                box-shadow: 0 8px 32px rgba(0,0,0,0.12);
                display: flex;
                flex-direction: column;
                height: 60vh;
                max-height: calc(100vh - 24px);
                overflow: hidden;
            }

            .meibot-panel h3 {
                margin: 0;
                padding: 20px;
                font-size: 20px;
                font-weight: 700;
                background: var(--accent-color, #0089f1);
                color: white;
                border-radius: 16px 16px 0 0;
                flex-shrink: 0;
                letter-spacing: 0.3px;
            }

            .meibot-panel #meibot-chat {
                flex: 1;
                overflow-y: auto;
                padding: 16px;
                display: flex;
                flex-direction: column;
                gap: 12px;
                background: transparent;
            }

            .meibot-message {
                display: flex;
                gap: 8px;
                margin-bottom: 4px;
                align-items: flex-end;
            }

            .meibot-message.user {
                justify-content: flex-end;
            }

            .meibot-message-text {
                max-width: 80%;
                padding: 12px 16px;
                border-radius: 12px;
                word-wrap: break-word;
                font-size: 14px;
                line-height: 1.4;
                box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            }

            .meibot-message.user .meibot-message-text {
                background: linear-gradient(135deg, var(--accent-color, #0089f1), var(--accent-hover, #0073d1));
                color: white;
                border-radius: 12px 4px 12px 12px;
                font-weight: 500;
            }

            .meibot-message.meibot .meibot-message-text {
                background: white;
                color: #333;
                border-radius: 4px 12px 12px 12px;
                border: 1px solid #e8e8e8;
            }

            .meibot-panel #meibot-form {
                padding: 16px;
                border-top: 1px solid #e8e8e8;
                display: flex;
                gap: 10px;
                flex-wrap: nowrap;
                flex-shrink: 0;
                background: transparent;
            }

            .meibot-panel #meibot-input {
                flex: 1;
                min-width: 120px;
                padding: 12px 16px;
                border: 1.5px solid #e0e0e0;
                border-radius: 10px;
                font-size: 14px;
                background: white;
                transition: all 0.2s ease;
                font-family: inherit;
            }

            .meibot-panel #meibot-input::placeholder {
                color: #999;
            }

            .meibot-panel #meibot-input:focus {
                outline: none;
                border-color: var(--accent-color, #0089f1);
                background: white;
                box-shadow: 0 0 0 3px rgba(0,137,241,0.1);
            }

            .meibot-panel .small-tmr-btn {
                padding: 12px 20px;
                background: var(--accent-color, #0089f1);
                color: white;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 600;
                transition: all 0.2s ease;
                white-space: nowrap;
                flex-shrink: 0;
                box-shadow: 0 2px 8px rgba(0,137,241,0.2);
            }

            .meibot-panel .small-tmr-btn:hover {
                background: var(--accent-hover, #0073d1);
                box-shadow: 0 4px 12px rgba(0,137,241,0.3);
                transform: translateY(-1px);
            }

            .meibot-panel .small-tmr-btn:active {
                transform: translateY(0);
                box-shadow: 0 1px 4px rgba(0,137,241,0.2);
            }

            /* Calendar Section in CENTER */
            .calendar-section {
                flex: 0 0 720px;
                overflow: hidden;
                background: transparent;
                border-radius: 0;
                box-shadow: none;
                height: 60vh;
                max-height: calc(100vh - 24px);
            }

            /* Hide panels-container (we're using new layout) */
            .panels-container {
                display: none !important;
            }

            /* Hide mobile buttons on desktop */
            .calendar-buttons {
                display: none;
            }

            /* Hide modals on desktop (panels always visible) */
            #todo-modal-backdrop,
            #meibot-modal,
            #todo-modal-backdrop.shown,
            #meibot-modal.shown,
            #todo-modal-backdrop.active,
            #meibot-modal.active {
                display: none !important;
            }

        }

        /* ===== Mobile Landscape (ANY landscape orientation) ===== */
        @media (max-width: 1024px) and (orientation: landscape) {
            :root {
                --tmr-mobile-top: calc(env(safe-area-inset-top, 0px) + 48px);
            }

            body {
                display: flex;
                flex-direction: row;
                height: 100vh;
                overflow: hidden;
            }

            .calendar-page {
                display: flex;
                flex-direction: row;
                width: 100%;
                height: 100%;
                position: relative;
                gap: 0;
            }

            /* Hide desktop panels on mobile */
            .todo-panel, .meibot-panel {
                display: none !important;
            }

            /* Hide desktop calendar and show mobile calendar */
            #calendar-app {
                display: none !important;
            }

            #mobile-calendar-container {
                display: flex !important;
                flex: 1;
                min-width: 0;
            }

            /* Buttons on RIGHT side in landscape - FIXED POSITION */
            .calendar-buttons {
                position: fixed !important;
                top: var(--tmr-mobile-top) !important;
                right: 568px !important;
                bottom: 8px !important;
                width: 55px;
                height: calc(100% - 78px);
                 gap: 6px !important;
                  padding: 6px 4px !important;
                margin: 0;
                border-left: none;
                                             background: linear-gradient(180deg, rgba(255,255,255,0.62), rgba(255,255,255,0.42)) !important;
                        backdrop-filter: blur(18px) saturate(160%) !important;
                        -webkit-backdrop-filter: blur(18px) saturate(160%) !important;
                                                border: 1px solid rgba(255,255,255,0.35) !important;
                                 box-shadow: 0 10px 28px rgba(0,0,0,0.14), inset 0 1px 0 rgba(255,255,255,0.40) !important;
                flex-shrink: 0;
                align-items: stretch;
                display: flex;
                flex-direction: column;
                z-index: 200;
                  border-radius: 9999px !important;
                  box-sizing: border-box !important;
            }

            .calendar-buttons button {
                flex: 1;
                width: 42px;
                 padding: 0 !important;
                border: none !important;
                 border-radius: 10px !important;
                 background: transparent !important;
                 color: var(--accent-color, #0089f1) !important;
                 font-size: 12px !important;
                 font-weight: 600 !important;
                cursor: pointer;
                writing-mode: vertical-rl;
                text-orientation: mixed;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: none !important;
                transform: none !important;
                transition: none !important;
                 text-decoration: none !important;
                 text-underline-offset: 6px;
                 text-decoration-thickness: 2px;
            }

            .calendar-buttons button:hover:not(.active) {
                 background: transparent !important;
            }

            .calendar-buttons button.active {
                 background: transparent !important;
                 color: var(--accent-color, #0089f1) !important;
                 font-weight: 700 !important;
                 text-decoration: underline !important;
            }

            .calendar-buttons button.active:hover {
                 background: transparent !important;
            }

            /* Calendar section with rounded left corner */
            .calendar-section {
                position: fixed !important;
                top: var(--tmr-mobile-top) !important;
                left: 8px !important;
                bottom: 13px !important;
                right: 618px !important;
                width: calc(100% - 626px);
                height: calc(100% - 88px);
                overflow: hidden;
                border-radius: 12px 0 0 12px;
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
            }

            /* Todo and Meibot modals with square right edge to blend with button left edges */
            #todo-modal-backdrop,
            #meibot-modal {
                position: fixed !important;
                top: var(--tmr-mobile-top) !important;
                left: 8px !important;
                bottom: 13px !important;
                right: 618px !important;
                width: calc(100% - 626px);
                height: calc(100% - 88px);
                overflow: hidden;
                border-radius: 12px !important;
            }

            /* Calendar section visibility */
            .calendar-section {
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex;
                flex-direction: column;
                z-index: 50;
            }

            .calendar-section.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            /* Modals overlay on calendar space */
            #todo-modal-backdrop {
                background: none !important;
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex !important;
                flex-direction: column !important;
                z-index: 100;
            }

            #todo-modal-backdrop.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            #meibot-modal {
                background: none !important;
                overflow: hidden !important;
                flex-direction: column !important;
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex !important;
                z-index: 100;
            }

            #meibot-modal.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            /* TODO MODAL - full screen in landscape */
            .todo-modal {
                background: rgba(255, 255, 255, 0.45);
                backdrop-filter: blur(16px) saturate(165%);
                -webkit-backdrop-filter: blur(16px) saturate(165%);
                border: none;
                box-shadow: none;
                height: auto;
                max-height: calc(100vh - 150px);
                width: 100%;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                border-radius: 12px !important;
                margin: 0;
                padding: 0;
            }

            .todo-modal .todo-banner {
                margin: 0;
                padding: 16px;
                background: var(--accent-color, #0089f1);
                background: color-mix(in srgb, var(--accent-color, #0089f1) 70%, transparent);
                backdrop-filter: blur(20px) saturate(190%);
                -webkit-backdrop-filter: blur(20px) saturate(190%);
                position: relative;
                overflow: hidden;
                box-shadow: inset 0 1px 0 rgba(255,255,255,0.55), inset 0 -1px 0 rgba(255,255,255,0.22);
                color: white;
                display: flex;
                align-items: center;
                flex-shrink: 0;
                border-radius: 12px 12px 0 0;
            }

            .todo-modal .todo-banner::before {
                content: "";
                position: absolute;
                inset: 0;
                background:
                    radial-gradient(120% 140% at 0% 0%, rgba(255,255,255,0.42), transparent 55%),
                    radial-gradient(120% 140% at 100% 0%, rgba(255,255,255,0.34), transparent 55%),
                    radial-gradient(140% 200% at 50% 120%, rgba(255,255,255,0.20), transparent 60%),
                    linear-gradient(135deg, rgba(255,255,255,0.16), transparent 45%);
                opacity: 0.98;
                pointer-events: none;
            }

            .todo-modal .todo-banner > * {
                position: relative;
                z-index: 1;
            }

            .todo-modal .todo-banner h3 {
                margin: 0;
                padding: 0;
                color: white;
                font-size: 18px;
                font-weight: 600;
            }

            .todo-modal .todo-input-row {
                padding: 16px;
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
                background: rgba(255, 255, 255, 0.15);
                flex-shrink: 0;
                border-bottom: 1px solid #eee;
            }

            .todo-modal input[type="text"],
            .todo-modal input[type="number"] {
                flex: 1;
                min-width: 150px;
                padding: 10px 12px;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                font-size: 14px;
                transition: border-color 0.2s ease;
            }

            .todo-modal input:focus {
                outline: none;
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 0 0 3px rgba(0,137,241,0.15);
            }

            .todo-modal .todo-list {
                max-height: 70vh;
                overflow-y: auto;
                list-style: none;
                padding: 16px;
                margin: 0;
                display: flex;
                flex-direction: column;
                gap: 8px;
                flex: 1;
            }

            .todo-modal .todo-item {
                background: linear-gradient(135deg, #f8f9fa, #f0f3f7);
                border: 1px solid #e0e8f0;
                padding: 12px;
                border-radius: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 8px;
                transition: all 0.2s ease;
            }

            .todo-modal .todo-item:hover {
                background: linear-gradient(135deg, #f0f3f7, #e8ecf2);
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 2px 8px rgba(0,137,241,0.1);
            }

            .todo-modal .small-tmr-btn {
                background: #d7dbdf !important;
                border: none !important;
                color: #333 !important;
                padding: 8px 14px !important;
                border-radius: 8px !important;
                box-shadow: none !important;
                transition: background 0.15s ease !important;
                transform: none !important;
            }

            /* MEIBOT MODAL - full screen in landscape */
            .meibot-modal-content {
                height: 100%;
                width: 100%;
                display: flex;
                flex-direction: column;
                background: rgba(255, 255, 255, 0.5) !important;
                backdrop-filter: blur(12px) !important;
                -webkit-backdrop-filter: blur(12px) !important;
                box-shadow: 0 8px 32px rgba(0,0,0,0.12);
                overflow: hidden;
                border-radius: 16px;
                margin: 0;
            }

            .meibot-header {
                margin: 0;
                padding: 16px;
                font-size: 20px;
                font-weight: 700;
                background: var(--accent-color, #0089f1);
                background: color-mix(in srgb, var(--accent-color, #0089f1) 70%, transparent);
                backdrop-filter: blur(20px) saturate(190%);
                -webkit-backdrop-filter: blur(20px) saturate(190%);
                position: relative;
                overflow: hidden;
                box-shadow: inset 0 1px 0 rgba(255,255,255,0.55), inset 0 -1px 0 rgba(255,255,255,0.22);
                color: white;
                flex-shrink: 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-radius: 16px 16px 0 0;
                letter-spacing: 0.3px;
            }

            .meibot-header::before {
                content: "";
                position: absolute;
                inset: 0;
                background:
                    radial-gradient(120% 140% at 0% 0%, rgba(255,255,255,0.42), transparent 55%),
                    radial-gradient(120% 140% at 100% 0%, rgba(255,255,255,0.34), transparent 55%),
                    radial-gradient(140% 200% at 50% 120%, rgba(255,255,255,0.20), transparent 60%),
                    linear-gradient(135deg, rgba(255,255,255,0.16), transparent 45%);
                opacity: 0.98;
                pointer-events: none;
            }

            .meibot-header > * {
                position: relative;
                z-index: 1;
            }

            .meibot-header h2 {
                margin: 0;
                padding: 0;
                font-size: inherit;
                font-weight: inherit;
                line-height: 1.1;
            }

            .meibot-chat {
                flex: 1;
                overflow-y: auto;
                padding: 16px;
                background: transparent;
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .meibot-chat .meibot-message {
                display: flex;
                gap: 8px;
                margin-bottom: 4px;
                align-items: flex-end;
            }

            .meibot-chat .meibot-message.user {
                justify-content: flex-end;
            }

            .meibot-chat .meibot-message-text {
                max-width: 80%;
                padding: 12px 16px;
                border-radius: 12px;
                word-wrap: break-word;
                font-size: 14px;
                line-height: 1.4;
                box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            }

            .meibot-chat .meibot-message.user .meibot-message-text {
                background: linear-gradient(135deg, var(--accent-color, #0089f1), var(--accent-hover, #0073d1));
                color: white;
                border-radius: 12px 4px 12px 12px;
                font-weight: 500;
            }

            .meibot-chat .meibot-message.meibot .meibot-message-text {
                background: white;
                color: #333;
                border-radius: 4px 12px 12px 12px;
                border: 1px solid #e8e8e8;
            }

            .meibot-chat .meibot-action-btn {
                display: block;
                width: 100%;
                margin-top: 12px;
                padding: 12px;
                border: none;
                border-radius: 8px;
                color: white;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }

            #meibot-modal-form {
                padding: 16px;
                border-top: 1px solid #e8e8e8;
                display: flex;
                gap: 10px;
                flex-wrap: nowrap;
                flex-shrink: 0;
                background: transparent;
            }

            #meibot-modal-input {
                flex: 1 1 auto;
                flex: 0 0 auto;
                min-width: 0;
                padding: 12px 16px;
                border: 1.5px solid #e0e0e0;
                border-radius: 10px;
                font-size: 14px;
                background: white;
                transition: all 0.2s ease;
                font-family: inherit;
            }

            #meibot-modal-form > button.small-tmr-btn {
                flex: 0 0 auto;
                width: auto;
                padding: 10px 14px;
                white-space: nowrap;
                background: var(--accent-color, #0089f1);
                background: color-mix(in srgb, var(--accent-color, #0089f1) 70%, transparent);
                backdrop-filter: blur(18px) saturate(190%);
                -webkit-backdrop-filter: blur(18px) saturate(190%);
                border: none;
                color: white;
                position: relative;
                overflow: hidden;
                box-shadow: inset 0 1px 0 rgba(255,255,255,0.55), inset 0 -1px 0 rgba(255,255,255,0.22), 0 2px 8px rgba(0,0,0,0.10);
            }

            #meibot-modal-form > button.small-tmr-btn::before {
                content: "";
                position: absolute;
                inset: 0;
                background:
                    radial-gradient(120% 140% at 0% 0%, rgba(255,255,255,0.42), transparent 55%),
                    radial-gradient(120% 140% at 100% 0%, rgba(255,255,255,0.34), transparent 55%),
                    linear-gradient(135deg, rgba(255,255,255,0.16), transparent 45%);
                opacity: 0.98;
                pointer-events: none;
            }

            #meibot-modal-form > button.small-tmr-btn > * {
                position: relative;
                z-index: 1;
            }

            #meibot-modal-input::placeholder {
                color: #999;
            }

            #meibot-modal-input:focus {
                outline: none;
                border-color: var(--accent-color, #0089f1);
                background: white;
                box-shadow: 0 0 0 3px rgba(0,137,241,0.1);
            }

            .meibot-modal-content .small-tmr-btn {
                padding: 12px 20px;
                background: var(--accent-color, #0089f1);
                color: white;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 600;
                transition: all 0.2s ease;
                white-space: nowrap;
                flex-shrink: 0;
                box-shadow: 0 2px 8px rgba(0,137,241,0.2);
            }

            .meibot-modal-content .small-tmr-btn:hover {
                background: var(--accent-hover, #0073d1);
                box-shadow: 0 4px 12px rgba(0,137,241,0.3);
                transform: translateY(-1px);
            }

            .meibot-modal-content .small-tmr-btn:active {
                transform: translateY(0);
                box-shadow: 0 1px 4px rgba(0,137,241,0.2);
            }
        }

        @media (max-width: 1024px) and (orientation: portrait) {
            :root {
                --tmr-mobile-top: calc(env(safe-area-inset-top, 0px) + 48px);
                --tmr-mobile-tabs-height: 50px;
                --tmr-mobile-tabs-gap: 6px;
                --tmr-mobile-content-top: calc(var(--tmr-mobile-top) + var(--tmr-mobile-tabs-height) + var(--tmr-mobile-tabs-gap));
            }

            body {
                display: flex;
                flex-direction: column;
                height: 100vh;
                overflow: hidden;
            }

            .calendar-page {
                display: flex;
                flex-direction: column;
                width: 100%;
                height: 100%;
                position: relative;
                overflow: hidden;
            }

            /* Hide desktop panels on mobile */
            .todo-panel, .meibot-panel {
                display: none !important;
            }

            /* Hide desktop calendar and show mobile calendar */
            #calendar-app {
                display: none !important;
            }

            #mobile-calendar-container {
                display: flex !important;
                flex: 0 0 auto;
                min-width: 0;
            }

            /* Buttons on TOP in portrait (like tabs) - FIXED POSITION */
            .calendar-buttons {
                position: fixed !important;
                top: var(--tmr-mobile-top) !important;
                 left: calc(env(safe-area-inset-left, 0px) + 6px) !important;
                 right: calc(env(safe-area-inset-right, 0px) + 6px) !important;
                height: 50px;
                 width: auto;
                  gap: 8px !important;
                  padding: 0 10px !important;
                margin: 0;
                border-bottom: none;
                                             background: linear-gradient(180deg, rgba(255,255,255,0.62), rgba(255,255,255,0.42)) !important;
                        backdrop-filter: blur(18px) saturate(160%) !important;
                        -webkit-backdrop-filter: blur(18px) saturate(160%) !important;
                                                border: 1px solid rgba(255,255,255,0.35) !important;
                                 box-shadow: 0 10px 28px rgba(0,0,0,0.14), inset 0 1px 0 rgba(255,255,255,0.40) !important;
                flex-shrink: 0;
                align-items: center;
                display: flex;
                flex-direction: row;
                z-index: 200;
                  border-radius: 9999px !important;
                  box-sizing: border-box !important;
            }

            .calendar-buttons button {
                  flex: 1 1 0;
                 height: 50px;
                  padding: 0 4px !important;
                border: none !important;
                 border-radius: 0 !important;
                 background: transparent !important;
                 color: var(--accent-color, #0089f1) !important;
                  font-size: 12px !important;
                  font-weight: 600 !important;
                cursor: pointer;
                position: relative;
                bottom: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: none !important;
                transform: none !important;
                transition: none !important;
                 text-decoration: none !important;
                 text-underline-offset: 8px;
                 text-decoration-thickness: 2px;
                  min-width: 0;
                  white-space: nowrap;
            }

            .calendar-buttons button:hover:not(.active) {
                 background: transparent !important;
            }

            .calendar-buttons button.active {
                 background: transparent !important;
                 color: var(--accent-color, #0089f1) !important;
                 font-weight: 700 !important;
                 text-decoration: underline !important;
            }

            .calendar-buttons button.active:hover {
                 background: transparent !important;
            }

              .calendar-buttons button:active {
                 text-decoration: underline !important;
              }

            /* Calendar section with rounded bottom */
            .calendar-section {
                position: fixed !important;
                top: var(--tmr-mobile-content-top) !important;
                left: 8px !important;
                right: 8px !important;
                bottom: 68px !important;
                width: calc(100% - 16px);
                overflow: hidden;
                border-radius: 0 0 12px 12px;
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
            }

            /* Todo and Meibot modals with square edges to blend with button bottoms */
            #todo-modal-backdrop,
            #meibot-modal {
                position: fixed !important;
                top: var(--tmr-mobile-content-top) !important;
                left: 8px !important;
                right: 8px !important;
                width: calc(100% - 16px);
                overflow: hidden;
                border-radius: 12px !important;
                bottom: 68px !important;
                height: auto;
            }

            /* Calendar section visibility */
            .calendar-section {
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex;
                flex-direction: column;
                z-index: 50;
            }

            .calendar-section.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            /* Modals overlay on calendar space */
            #todo-modal-backdrop {
                background: none !important;
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex !important;
                flex-direction: column !important;
                z-index: 100;
            }

            #todo-modal-backdrop.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            #meibot-modal {
                background: none !important;
                overflow: hidden !important;
                flex-direction: column !important;
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex !important;
                z-index: 100;
            }

            #meibot-modal.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            /* TODO MODAL - full screen in portrait */
            .todo-modal {
                background: rgba(255, 255, 255, 0.45);
                backdrop-filter: blur(16px) saturate(165%);
                -webkit-backdrop-filter: blur(16px) saturate(165%);
                border: none;
                box-shadow: none;
                height: 100%;
                max-height: none;
                width: 100%;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                border-radius: 12px !important;
                margin: 0;
                padding: 0;
            }

            .todo-modal .todo-banner {
                margin: 0;
                padding: 16px;
                background: var(--accent-color, #0089f1);
                background: color-mix(in srgb, var(--accent-color, #0089f1) 70%, transparent);
                backdrop-filter: blur(20px) saturate(190%);
                -webkit-backdrop-filter: blur(20px) saturate(190%);
                position: relative;
                overflow: hidden;
                box-shadow: inset 0 1px 0 rgba(255,255,255,0.55), inset 0 -1px 0 rgba(255,255,255,0.22);
                color: white;
                display: flex;
                align-items: center;
                flex-shrink: 0;
                border-radius: 12px 12px 0 0;
            }

            .todo-modal .todo-banner::before {
                content: "";
                position: absolute;
                inset: 0;
                background:
                    radial-gradient(120% 140% at 0% 0%, rgba(255,255,255,0.42), transparent 55%),
                    radial-gradient(120% 140% at 100% 0%, rgba(255,255,255,0.34), transparent 55%),
                    radial-gradient(140% 200% at 50% 120%, rgba(255,255,255,0.20), transparent 60%),
                    linear-gradient(135deg, rgba(255,255,255,0.16), transparent 45%);
                opacity: 0.98;
                pointer-events: none;
            }

            .todo-modal .todo-banner > * {
                position: relative;
                z-index: 1;
            }

            .todo-modal .todo-banner h3 {
                margin: 0;
                padding: 0;
                color: white;
                font-size: 18px;
                font-weight: 600;
            }

            .todo-modal .todo-input-row {
                padding: 16px;
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
                background: rgba(255, 255, 255, 0.15);
                flex-shrink: 0;
                border-bottom: 1px solid #eee;
            }

            .todo-modal input[type="text"],
            .todo-modal input[type="number"] {
                flex: 1;
                min-width: 150px;
                padding: 10px 12px;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                font-size: 14px;
                transition: border-color 0.2s ease;
            }

            .todo-modal input:focus {
                outline: none;
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 0 0 3px rgba(0,137,241,0.15);
            }

            .todo-modal .todo-list {
                max-height: 70vh;
                overflow-y: auto;
                list-style: none;
                padding: 16px;
                margin: 0;
                display: flex;
                flex-direction: column;
                gap: 8px;
                flex: 1;
            }

            .todo-modal .todo-item {
                background: linear-gradient(135deg, #f8f9fa, #f0f3f7);
                border: 1px solid #e0e8f0;
                padding: 12px;
                border-radius: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 8px;
                transition: all 0.2s ease;
            }

            .todo-modal .todo-item:hover {
                background: linear-gradient(135deg, #f0f3f7, #e8ecf2);
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 2px 8px rgba(0,137,241,0.1);
            }

            .todo-modal .small-tmr-btn {
                background: #d7dbdf !important;
                border: none !important;
                color: #333 !important;
                padding: 8px 14px !important;
                border-radius: 8px !important;
                box-shadow: none !important;
                transition: background 0.15s ease !important;
                transform: none !important;
            }

            /* MEIBOT MODAL - full screen in portrait */
            .meibot-modal-content {
                height: 100%;
                width: 100%;
                display: flex;
                flex-direction: column;
                background: rgba(255, 255, 255, 0.5) !important;
                backdrop-filter: blur(12px) !important;
                -webkit-backdrop-filter: blur(12px) !important;
                box-shadow: 0 8px 32px rgba(0,0,0,0.12);
                overflow: hidden;
                border-radius: 16px;
                margin: 0;
            }

            .meibot-header {
                margin: 0;
                padding: 16px;
                font-size: 20px;
                font-weight: 700;
                background: var(--accent-color, #0089f1);
                background: color-mix(in srgb, var(--accent-color, #0089f1) 70%, transparent);
                backdrop-filter: blur(20px) saturate(190%);
                -webkit-backdrop-filter: blur(20px) saturate(190%);
                position: relative;
                overflow: hidden;
                box-shadow: inset 0 1px 0 rgba(255,255,255,0.55), inset 0 -1px 0 rgba(255,255,255,0.22);
                color: white;
                flex-shrink: 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-radius: 16px 16px 0 0;
                letter-spacing: 0.3px;
            }

            .meibot-header::before {
                content: "";
                position: absolute;
                inset: 0;
                background:
                    radial-gradient(120% 140% at 0% 0%, rgba(255,255,255,0.42), transparent 55%),
                    radial-gradient(120% 140% at 100% 0%, rgba(255,255,255,0.34), transparent 55%),
                    radial-gradient(140% 200% at 50% 120%, rgba(255,255,255,0.20), transparent 60%),
                    linear-gradient(135deg, rgba(255,255,255,0.16), transparent 45%);
                opacity: 0.98;
                pointer-events: none;
            }

            .meibot-header > * {
                position: relative;
                z-index: 1;
            }

            .meibot-header h2 {
                margin: 0;
                padding: 0;
                font-size: inherit;
                font-weight: inherit;
                line-height: 1.1;
            }

            .meibot-chat {
                flex: 1;
                overflow-y: auto;
                padding: 16px;
                background: transparent;
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .meibot-chat .meibot-message {
                display: flex;
                gap: 8px;
                margin-bottom: 4px;
                align-items: flex-end;
            }

            .meibot-chat .meibot-message.user {
                justify-content: flex-end;
            }

            .meibot-chat .meibot-message-text {
                max-width: 80%;
                padding: 12px 16px;
                border-radius: 12px;
                word-wrap: break-word;
                font-size: 14px;
                line-height: 1.4;
                box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            }

            .meibot-chat .meibot-message.user .meibot-message-text {
                background: linear-gradient(135deg, var(--accent-color, #0089f1), var(--accent-hover, #0073d1));
                color: white;
                border-radius: 12px 4px 12px 12px;
                font-weight: 500;
            }

            .meibot-chat .meibot-message.meibot .meibot-message-text {
                background: white;
                color: #333;
                border-radius: 4px 12px 12px 12px;
                border: 1px solid #e8e8e8;
            }

            .meibot-chat .meibot-action-btn {
                display: block;
                width: 100%;
                margin-top: 12px;
                padding: 12px;
                border: none;
                border-radius: 8px;
                color: white;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            }

            #meibot-modal-form {
                padding: 16px;
                border-top: 1px solid #e8e8e8;
                display: flex;
                gap: 10px;
                flex-wrap: nowrap;
                flex-shrink: 0;
                background: transparent;
            }

            #meibot-modal-input {
                flex: 1 1 auto;
                min-width: 0;
                padding: 12px 16px;
                border: 1.5px solid #e0e0e0;
                border-radius: 10px;
                font-size: 14px;
                background: white;
                transition: all 0.2s ease;
                font-family: inherit;
            }

            #meibot-modal-form > button.small-tmr-btn {
                flex: 0 0 auto;
                width: auto;
                padding: 10px 14px;
                white-space: nowrap;
                background: var(--accent-color, #0089f1);
                background: color-mix(in srgb, var(--accent-color, #0089f1) 70%, transparent);
                backdrop-filter: blur(18px) saturate(190%);
                -webkit-backdrop-filter: blur(18px) saturate(190%);
                border: none;
                color: white;
                position: relative;
                overflow: hidden;
                box-shadow: inset 0 1px 0 rgba(255,255,255,0.55), inset 0 -1px 0 rgba(255,255,255,0.22), 0 2px 8px rgba(0,0,0,0.10);
            }

            #meibot-modal-form > button.small-tmr-btn::before {
                content: "";
                position: absolute;
                inset: 0;
                background:
                    radial-gradient(120% 140% at 0% 0%, rgba(255,255,255,0.42), transparent 55%),
                    radial-gradient(120% 140% at 100% 0%, rgba(255,255,255,0.34), transparent 55%),
                    linear-gradient(135deg, rgba(255,255,255,0.16), transparent 45%);
                opacity: 0.98;
                pointer-events: none;
            }

            #meibot-modal-form > button.small-tmr-btn > * {
                position: relative;
                z-index: 1;
            }

            #meibot-modal-input::placeholder {
                color: #999;
            }

            #meibot-modal-input:focus {
                outline: none;
                border-color: var(--accent-color, #0089f1);
                background: white;
                box-shadow: 0 0 0 3px rgba(0,137,241,0.1);
            }

            .meibot-modal-content .small-tmr-btn {
                padding: 12px 20px;
                background: var(--accent-color, #0089f1);
                color: white;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 600;
                transition: all 0.2s ease;
                white-space: nowrap;
                flex-shrink: 0;
                box-shadow: 0 2px 8px rgba(0,137,241,0.2);
            }

            .meibot-modal-content .small-tmr-btn:hover {
                background: var(--accent-hover, #0073d1);
                box-shadow: 0 4px 12px rgba(0,137,241,0.3);
                transform: translateY(-1px);
            }

            .meibot-modal-content .small-tmr-btn:active {
                transform: translateY(0);
                box-shadow: 0 1px 4px rgba(0,137,241,0.2);
            }
        }

        /* ===== Base Styles for New Layout ===== */
        .calendar-page {
            width: 100%;
        }

        .todo-panel, .meibot-panel {
            position: relative;
        }

        /* Ensure modals display as flex when shown */
        #todo-modal-backdrop.shown,
        #meibot-modal.shown {
            display: flex !important;
        }

        .todo-modal-backdrop.shown {
            display: flex !important;
        }
    </style>
</head>

<body class="page-background triangle-background currentschedules-page">

    <!-- PAGE HEADER (Desktop only) -->
    <header class="page-header" style="display:none;">
        <!-- Left: TMR Button + Settings Menu -->
        <div class="header-left">
            <button id="header-login-btn" class="header-text-btn" title="Login or create account">👤 Account</button>
            <button id="tmr-header-btn" class="header-text-btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
                TMR
                <svg class="gear-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m2.98 2.98l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m2.98-2.98l4.24-4.24M19.78 19.78l-4.24-4.24m-2.98-2.98l-4.24-4.24"></path>
                </svg>
            </button>
            <!-- Logout controls intentionally removed (use the Account modal flow instead) -->
        </div>
        
        <!-- Center: Search (desktop shows input; mobile shows icon) -->
        <div class="header-center">
            <div class="search-container">
                <input id="header-search-input" type="text" placeholder="Search events, notes..." class="search-input" aria-label="Search">
                <button id="search-clear-btn" class="search-clear-btn" aria-label="Clear search" title="Clear search">✕</button>
                <div id="search-suggestions" class="search-suggestions" hidden></div>
            </div>
        </div>
        
        <!-- Right: Clock + Notes + Themes + Username + Logout -->
        <div class="header-right">
            <div id="header-clock" class="header-clock">--:--:-- --</div>
            <button id="header-notes-btn" class="header-text-btn" title="Open Notes">📝 Notes</button>
            <button id="header-themes-btn" class="header-text-btn" title="Themes">🎨 Themes</button>
            <span id="header-username" class="header-username" title="Current user">👤 Guest</span>
            <button id="header-logout-btn" class="header-text-btn" title="Logout" style="display:none;">🚪 Logout</button>
        </div>
    </header>

    <!-- TMR menu modal (shared by desktop + mobile bottom bar) -->
    <div id="tmr-menu-backdrop" class="mobile-modal-backdrop" hidden>
    <div id="tmr-header-menu" class="tmr-menu tmr-modal-panel" hidden>
        <div class="tmr-menu-item">
            <label>
                <input id="notify-toggle" type="checkbox" /> Enable notifications
            </label>
        </div>
        <div class="tmr-menu-item">
            <button id="notify-open-onboard-btn" class="small-tmr-btn" type="button">Enable notifications…</button>
        </div>
        <div class="tmr-menu-item">
            <label for="notify-mode">Notification mode
                <select id="notify-mode" style="margin-left:8px;">
                    <option value="both">Local + Server (default)</option>
                    <option value="local">Local only</option>
                    <option value="server">Server only</option>
                </select>
            </label>
        </div>
        <div class="tmr-menu-item">
            <label for="todo-default-reminder">Default todo reminder (minutes)
                <input id="todo-default-reminder" type="number" min="0" value="10" title="Default minutes before reminder">
            </label>
        </div>
        <div class="tmr-menu-item">
            <button id="notify-test-btn" class="small-tmr-btn" type="button">Test notification</button>
        </div>
        <div class="tmr-menu-item">
            <label>
                <input id="push-enable" type="checkbox" /> Enable background push (Service Worker)
            </label>
            <div style="margin-top:6px;">
                <input id="vapid-public-input" placeholder="VAPID public key (optional)" style="width:100%" />
                <button id="push-subscribe-btn" class="small-tmr-btn" type="button" style="margin-top:6px;">Subscribe for push</button>
                <button id="manage-subs-btn" class="small-tmr-btn" type="button" style="margin-top:6px;margin-left:6px;">Manage subscriptions</button>
            </div>
        </div>
        <div class="tmr-menu-item" style="border-top:1px solid #ccc; padding-top:8px; margin-top:8px;">
            <button id="tutorial-btn" class="small-tmr-btn" type="button">View Tutorial</button>
        </div>
        <div class="tmr-menu-item">
            <button id="export-data-btn" class="small-tmr-btn" type="button">Export data</button>
            <button id="import-data-btn" class="small-tmr-btn" type="button" style="margin-top:6px;">Import data</button>
            <input id="import-file-input" type="file" accept=".json" hidden />
        </div>
        <div class="tmr-menu-item">
            <button id="fullscreen-btn-tmr" type="button" class="small-tmr-btn">Fullscreen</button>
        </div>

        <div class="tmr-menu-item" style="border-top:1px solid #ccc; padding-top:8px; margin-top:8px;">
            <button id="accounts-tracker-btn" type="button" class="small-tmr-btn">🔒 Admin Only</button>
        </div>
    </div>
    </div>

    <!-- Accounts Tracker (Admin Only) -->
    <div id="accounts-tracker-backdrop" class="mobile-modal-backdrop" hidden>
        <div class="tmr-menu tmr-modal-panel" role="dialog" aria-modal="true" aria-labelledby="accounts-tracker-title" style="max-width: 680px;">
            <div class="tmr-menu-item" style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
                <strong id="accounts-tracker-title">Input password</strong>
                <button id="accounts-tracker-close" class="small-tmr-btn" type="button">Close</button>
            </div>
            <div class="tmr-menu-item">
                <label style="display:block;">
                    Password
                    <input id="accounts-tracker-password" type="password" autocomplete="off" placeholder="Enter admin password" style="width:100%; margin-top:6px;" />
                </label>
                <div style="display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap;">
                    <label class="small" style="display:flex; align-items:center; gap:8px;">
                        Limit
                        <input id="accounts-tracker-limit" type="number" min="1" max="5000" value="200" style="width:96px;" />
                    </label>
                    <button id="accounts-tracker-load" class="small-tmr-btn" type="button">Load</button>
                    <span id="accounts-tracker-status" class="small" style="opacity:0.9;"></span>
                </div>
            </div>
            <div class="tmr-menu-item" style="max-height: 55vh; overflow:auto;">
                <div id="accounts-tracker-results" class="small"></div>
            </div>
        </div>
    </div>

    <!-- Notifications permission prompt (shown when permission is "default") -->
    <div id="notify-onboard-backdrop" class="mobile-modal-backdrop" hidden>
        <div id="notify-onboard-modal" class="tmr-menu tmr-modal-panel" role="dialog" aria-modal="true" aria-labelledby="notify-onboard-title">
            <div class="tmr-menu-item">
                <strong id="notify-onboard-title">Enable notifications?</strong>
            </div>
            <div class="tmr-menu-item">
                Allow notifications so reminders can alert you on this device.
            </div>
            <div class="tmr-menu-item" style="display:flex; gap:8px; justify-content:flex-end;">
                <button id="notify-onboard-dismiss" class="small-tmr-btn" type="button">Not now</button>
                <button id="notify-onboard-enable" class="small-tmr-btn" type="button">Enable</button>
            </div>
        </div>
    </div>

    <!-- Main Page Container -->
    <div class="calendar-page">

        <!-- Mobile Buttons Bar (visible only on mobile <1025px) -->
        <div class="calendar-buttons">
            <button id="calendar-btn-mobile" class="tmr-btn small-tmr-btn active">📅 Calendar</button>
            <button id="todo-btn-mobile" class="tmr-btn small-tmr-btn">✓ Todo</button>
            <button id="meibot-btn-mobile" class="tmr-btn small-tmr-btn">🤖 Meibot</button>
        </div>

        <!-- TODO PANEL (LEFT SIDE - Desktop only) -->
        <div class="todo-panel">
            <div class="todo-banner">
                <h3>To Do</h3>
            </div>
            <button id="desktop-create-todo-btn" class="small-tmr-btn" style="width: 100%; padding: 12px; margin-bottom: 12px; font-size: 16px;">+ Create Todo</button>
            <ul id="todo-list" class="todo-list" aria-live="polite"></ul>
        </div>

        <!-- Calendar Section (CENTER - visible on all devices) -->
        <div class="calendar-section">
            <!-- Calendar app -->
            <div id="calendar-app" class="calendar-app">
                <div class="calendar-header">
                    <div style="display:flex; align-items:center; gap:8px;">
                        <button id="prev-month" class="nav-btn tmr-btn small-tmr-btn">&lt;</button>
                        <div id="month-year" class="month-year"></div>
                        <button id="next-month" class="nav-btn tmr-btn small-tmr-btn">&gt;</button>
                    </div>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <button id="view-month-btn" class="nav-btn tmr-btn small-tmr-btn" title="Month view">Month</button>
                        <button id="view-day-btn" class="nav-btn tmr-btn small-tmr-btn" title="Day view">Day</button>
                        <button id="view-today-btn" class="nav-btn tmr-btn small-tmr-btn" title="Jump to today">Today</button>
                        <button id="gcal-auth-btn" class="nav-btn tmr-btn small-tmr-btn" title="Connect to Google Calendar">🔗 Google Calendar</button>
                        <button id="gcal-sync-btn" class="nav-btn tmr-btn small-tmr-btn" style="display:none;" title="Sync with Google Calendar">🔄 Sync</button>
                        <button id="gcal-logout-btn" class="nav-btn tmr-btn small-tmr-btn" style="display:none;" title="Disconnect Google Calendar">⛔ Disconnect</button>
                    </div>
                </div>
                <div id="weekday-row" class="weekday-row" aria-hidden="false"></div>
                <div id="calendar" class="calendar-grid" aria-label="Monthly calendar"></div>

                <!-- Day view (desktop + tablet). Hidden by default; toggled by calendar.js -->
                <div id="day-view" class="day-view" hidden aria-label="Day view">
                    <div class="day-view-header">
                        <button id="day-prev" class="day-nav-btn" type="button" title="Previous day">&lt;</button>
                        <div id="day-title" class="month-year">Day</div>
                        <button id="day-next" class="day-nav-btn" type="button" title="Next day">&gt;</button>
                    </div>
                    <div id="day-view-scroll" class="day-view-scroll" aria-label="Day timeline">
                        <div id="day-view-grid" class="day-view-grid">
                            <div id="day-time-col" class="day-time-col" aria-hidden="true"></div>
                            <div id="day-grid" class="day-grid" aria-label="Time grid">
                                <div id="day-grid-lines" class="day-grid-lines" aria-hidden="true"></div>
                                <div id="day-events-layer" class="day-events-layer" aria-label="Events"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile Calendar Container (hidden on desktop) -->
            <div id="mobile-calendar-container">
                <div class="mobile-calendar-header">
                    <button id="mobile-prev-month" class="mobile-nav-btn">&lt;</button>
                    <div class="month-year"></div>
                    <button id="mobile-next-month" class="mobile-nav-btn">&gt;</button>
                    <button id="mobile-gcal-menu-btn" class="mobile-nav-btn" title="Google Calendar">🔗</button>
                </div>

                <div class="mobile-calendar-grid-container">
                    <div class="mobile-weekday-row" id="mobile-weekday-row"></div>
                    <div class="mobile-calendar-grid" id="mobile-calendar-grid"></div>
                </div>

                <!-- Mobile Day View (phone timeline, mirrors desktop Day View) -->
                <div id="mobile-day-view" class="day-view" hidden aria-label="Day view">
                    <div class="day-view-header">
                        <button id="mobile-day-back" class="day-nav-btn" type="button" title="Back to month">←</button>
                        <button id="mobile-day-prev" class="day-nav-btn" type="button" title="Previous day">&lt;</button>
                        <div id="mobile-day-title" class="month-year">Day</div>
                        <button id="mobile-day-next" class="day-nav-btn" type="button" title="Next day">&gt;</button>
                    </div>
                    <div id="mobile-day-view-scroll" class="day-view-scroll" aria-label="Day timeline">
                        <div class="day-view-grid">
                            <div id="mobile-day-time-col" class="day-time-col" aria-hidden="true"></div>
                            <div id="mobile-day-grid" class="day-grid" aria-label="Time grid">
                                <div id="mobile-day-grid-lines" class="day-grid-lines" aria-hidden="true"></div>
                                <div id="mobile-day-events-layer" class="day-events-layer" aria-label="Events"></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div id="mobile-modal-backdrop" class="mobile-modal-backdrop">
                <div class="mobile-modal-content">
                    <div class="mobile-modal-header">
                        <span id="mobile-modal-title">Events</span>
                        <button id="mobile-modal-close" class="mobile-modal-close">&times;</button>
                    </div>
                    <div class="mobile-modal-body">
                        <div id="mobile-event-list" class="mobile-event-list"></div>
                        <form id="mobile-event-form" class="mobile-event-form">
                            <div class="mobile-form-group">
                                <label>Title</label>
                                <input id="mobile-event-title" type="text" required />
                            </div>
                            <div class="mobile-form-group">
                                <label>Time</label>
                                <input id="mobile-event-time" type="time" />
                            </div>
                            <div class="mobile-form-group">
                                <label>End time</label>
                                <input id="mobile-event-end-time" type="time" />
                            </div>
                            <div class="mobile-form-group">
                                <label>Notes</label>
                                <textarea id="mobile-event-notes" rows="3"></textarea>
                            </div>
                            <div class="mobile-form-group">
                                <label>Color</label>
                                <div class="mobile-color-picker">
                                    <button type="button" class="mobile-color-btn" data-color="#ff6b6b" title="Red" style="background: #ff6b6b;"></button>
                                    <button type="button" class="mobile-color-btn" data-color="#ff922b" title="Orange" style="background: #ff922b;"></button>
                                    <button type="button" class="mobile-color-btn" data-color="#ffd43b" title="Yellow" style="background: #ffd43b;"></button>
                                    <button type="button" class="mobile-color-btn" data-color="#51cf66" title="Green" style="background: #51cf66;"></button>
                                    <button type="button" class="mobile-color-btn" data-color="#0089f1" title="Blue" style="background: #0089f1;"></button>
                                    <button type="button" class="mobile-color-btn" data-color="#9775fa" title="Violet" style="background: #9775fa;"></button>
                                    <button type="button" class="mobile-color-btn" data-color="#1f1f1f" title="Black" style="background: #1f1f1f;"></button>
                                    <button type="button" class="mobile-color-btn" data-color="#999999" title="Grey" style="background: #999999;"></button>
                                    <button type="button" class="mobile-color-btn" data-color="#8B4513" title="Brown" style="background: #8B4513;"></button>
                                </div>
                            </div>
                            <div class="mobile-form-actions">
                                <button type="submit" class="mobile-save-btn">Save</button>
                                <button type="button" id="mobile-delete-btn" class="mobile-delete-btn danger" style="display:none;">Delete</button>
                                <button type="button" class="mobile-cancel-btn">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Mobile Search Modal (uses existing search styles) -->
            <div id="mobile-search-backdrop" class="mobile-modal-backdrop" style="display:none;">
                <div class="mobile-modal-content" style="max-width: 420px; width: 100%;">
                    <div class="mobile-modal-header">
                        <span>Search</span>
                        <button id="mobile-search-close" class="mobile-modal-close" aria-label="Close">&times;</button>
                    </div>
                    <div class="mobile-modal-body">
                        <div class="search-container">
                            <input id="mobile-search-input" type="text" placeholder="Search events, notes..." class="search-input" aria-label="Search">
                            <button id="mobile-search-clear" class="search-clear-btn" aria-label="Clear search" title="Clear search">✕</button>
                            <div id="mobile-search-suggestions" class="search-suggestions" hidden></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Google Calendar Modal (Mobile) -->
            <div id="gcal-mobile-modal-backdrop" class="gcal-mobile-modal-backdrop" style="display:none;">
                <div class="gcal-mobile-modal">
                    <div class="gcal-mobile-modal-header">
                        <span>Google Calendar</span>
                        <button id="gcal-mobile-modal-close" class="gcal-mobile-modal-close">&times;</button>
                    </div>
                    <div class="gcal-mobile-modal-body">
                        <button id="mobile-gcal-auth-btn" class="mobile-gcal-modal-btn" title="Connect to Google Calendar" style="display:none;">🔗 Connect to Google Calendar</button>
                        <button id="mobile-gcal-sync-btn" class="mobile-gcal-modal-btn" title="Sync with Google Calendar" style="display:none;">🔄 Sync Calendar</button>
                        <button id="mobile-gcal-logout-btn" class="mobile-gcal-modal-btn danger" title="Disconnect Google Calendar" style="display:none;">⛔ Disconnect</button>
                    </div>
                </div>
            </div>

            <!-- Day / event modal -->
            <div id="event-modal" class="modal hidden" aria-hidden="true">
                <div class="modal-content">
                    <div class="event-modal-header">
                        <h3 id="modal-title">Add Event</h3>
                        <button id="close-modal" class="modal-close" aria-label="Close">&times;</button>
                    </div>
                    <form id="event-form">
                        <input type="hidden" id="event-id">
                        <div class="form-group">
                            <label for="event-title">Title *</label>
                            <input id="event-title" type="text" required placeholder="Enter event title..." />
                        </div>

                        <div class="event-form-row">
                            <div class="form-group">
                                <label for="event-date">Date</label>
                                <input id="event-date" type="date" required />
                            </div>
                            <div class="form-group">
                                <label for="event-time">Time</label>
                                <input id="event-time" type="time" />
                            </div>
                            <div class="form-group">
                                <label for="event-end-time">End time</label>
                                <input id="event-end-time" type="time" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="event-notes">Notes</label>
                            <textarea id="event-notes" placeholder="Add notes..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Color</label>
                            <div id="color-picker" class="event-color-picker">
                                <button type="button" class="color-btn" data-color="#ff6b6b" title="Red" style="background: #ff6b6b;"></button>
                                <button type="button" class="color-btn" data-color="#ff922b" title="Orange" style="background: #ff922b;"></button>
                                <button type="button" class="color-btn" data-color="#ffd43b" title="Yellow" style="background: #ffd43b;"></button>
                                <button type="button" class="color-btn" data-color="#51cf66" title="Green" style="background: #51cf66;"></button>
                                <button type="button" class="color-btn" data-color="#0089f1" title="Blue" style="background: #0089f1;"></button>
                                <button type="button" class="color-btn" data-color="#9775fa" title="Violet" style="background: #9775fa;"></button>
                                <button type="button" class="color-btn" data-color="#1f1f1f" title="Black" style="background: #1f1f1f;"></button>
                                <button type="button" class="color-btn" data-color="#999999" title="Grey" style="background: #999999;"></button>
                                <button type="button" class="color-btn" data-color="#8B4513" title="Brown" style="background: #8B4513;"></button>
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" id="save-event" class="tmr-btn">Save</button>
                            <button type="button" id="delete-event" class="tmr-btn danger">Delete</button>
                            <button type="button" id="cancel-event" class="tmr-btn">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

        </div>

        <!-- Mobile Bottom Bar (portrait only) -->
        <div id="mobile-bottom-bar" class="mobile-bottom-bar" aria-hidden="true">
            <div class="mobile-bottom-left">
                <button id="mobile-tmr-btn" class="mobile-header-btn" title="TMR" aria-haspopup="true" aria-expanded="false">TMR ▾</button>
                <button id="mobile-search-btn" class="mobile-header-btn" title="Search" aria-label="Search">🔍</button>
            </div>
            <div id="mobile-header-clock" class="mobile-header-clock">--:-- --</div>
            <button id="mobile-more-btn" class="mobile-header-btn" title="More" aria-haspopup="true" aria-expanded="false">More ▴</button>
        </div>
            <!-- Mobile More dropdown (portrait only) -->
            <div id="mobile-more-menu" class="mobile-more-menu" hidden>
            <div class="tmr-menu-item"><span id="menu-username" style="padding: 0 8px; font-size: 14px; color: var(--accent-color, #0089f1);">Loading...</span></div>
            <div class="tmr-menu-item"><button id="menu-notes-btn" class="small-tmr-btn" tabindex="0">📝 Notes</button></div>
            <div class="tmr-menu-item"><button id="menu-themes-btn" class="small-tmr-btn" tabindex="0">🎨 Themes</button></div>
            <div class="tmr-menu-item"><button id="menu-logout-btn" class="small-tmr-btn" tabindex="0" style="display:none;" title="Logout">🚪 Logout</button></div>
        </div>

        <!-- MEIBOT PANEL (RIGHT SIDE - Desktop only) -->
        <div class="meibot-panel" style="background: rgba(255, 255, 255, 0.5) !important;">
            <h3>Meibot</h3>
            <div id="meibot-chat" class="meibot-chat" role="log" aria-live="polite" aria-label="Chat messages"></div>
            <form id="meibot-form" class="meibot-form" role="search">
                <input id="meibot-input" type="text" placeholder="Ask Meibot..." aria-label="Message input" autocomplete="off" />
                <button type="submit" class="small-tmr-btn" aria-label="Send message">Send</button>
            </form>
        </div>

        <!-- TODO MODAL (for mobile) -->
        <div id="todo-modal-backdrop" class="todo-modal-backdrop">
            <div class="todo-modal" role="dialog" aria-modal="true" aria-labelledby="todo-modal-title">
                <div class="todo-banner">
                    <h3 id="todo-modal-title">To Do</h3>
                    <button id="todo-modal-create-btn" class="small-tmr-btn">+ Create Todo</button>
                </div>
                <ul id="todo-modal-list" class="todo-list"></ul>
            </div>
        </div>

        <!-- DESKTOP VIEW TODO MODAL -->
        <div id="todo-view-modal-backdrop" class="todo-modal-backdrop" style="display: none;">
            <div class="todo-modal" role="dialog" aria-modal="true" aria-labelledby="todo-view-modal-title">
                <h3 id="todo-view-modal-title">View Todo</h3>
                <div class="todo-view-body">
                    <div class="todo-view-section">
                        <strong>Title:</strong>
                        <p id="todo-view-title" class="todo-view-title"></p>
                    </div>
                    <div class="todo-view-section">
                        <strong>Notes:</strong>
                        <p id="todo-view-notes" class="todo-view-notes"></p>
                    </div>
                    <div class="todo-view-actions">
                        <button id="todo-view-edit-btn" class="small-tmr-btn">Edit</button>
                        <button id="todo-view-close-btn" class="small-tmr-btn">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- DESKTOP CREATE/EDIT TODO MODAL -->
        <div id="todo-create-edit-modal-backdrop" class="todo-modal-backdrop" style="display: none;">
            <div class="todo-modal" role="dialog" aria-modal="true" aria-labelledby="todo-create-edit-modal-title" style="border-radius: 12px !important;">
                <h3 id="todo-create-edit-modal-title">Create Todo</h3>
                <div style="padding: 16px; display: flex; flex-direction: column; gap: 12px;">
                    <div>
                        <label for="todo-edit-title" style="display: block; font-weight: bold; margin-bottom: 4px;">Title *</label>
                        <input id="todo-edit-title" type="text" placeholder="Enter todo title..." style="width: 100%; padding: 10px 8px; border: 2px solid #e0e0e0; border-radius: 6px; box-sizing: border-box;" />
                    </div>
                    <div style="border-top: 1px solid #e0e0e0; padding-top: 12px;">
                        <label style="display: block; font-weight: bold; margin-bottom: 8px;">Reminder</label>
                        <div style="display: flex; gap: 6px; align-items: center; flex-wrap: wrap;">
                            <select id="todo-edit-reminder-type" style="padding: 10px 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                                <option value="none">No reminder</option>
                                <option value="minutes">In minutes</option>
                                <option value="time">At time</option>
                            </select>
                            <input id="todo-edit-reminder-minutes" type="number" min="0" placeholder="minutes" style="width: 80px; padding: 10px 8px; border: 2px solid #e0e0e0; border-radius: 6px; display: none;" />
                            <input id="todo-edit-reminder-time" type="time" style="padding: 10px 8px; border: 2px solid #e0e0e0; border-radius: 6px; display: none;" />
                        </div>
                    </div>
                    <div>
                        <label for="todo-edit-notes" style="display: block; font-weight: bold; margin-bottom: 4px;">Notes</label>
                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <button type="button" id="bullet-point-btn" class="small-tmr-btn" style="padding: 6px 12px; font-size: 14px;">• Bullet</button>
                            <button type="button" id="checkbox-marker-btn" class="small-tmr-btn" style="padding: 6px 12px; font-size: 14px;">☐ Checkbox</button>
                        </div>
                        <textarea id="todo-edit-notes" placeholder="Add detailed notes..." style="width: 100%; padding: 10px 8px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px; box-sizing: border-box; font-family: inherit;"></textarea>
                    </div>
                    <div style="border-top: 1px solid #e0e0e0; padding-top: 12px; display: flex; gap: 8px; justify-content: flex-end;">
                        <button id="todo-edit-save-btn" class="small-tmr-btn">Save</button>
                        <button id="todo-edit-cancel-btn" class="small-tmr-btn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MEIBOT MODAL (for mobile) -->
        <div id="meibot-modal" class="meibot-modal">
            <div class="meibot-modal-content">
                <div class="meibot-header">
                    <h2>Meibot</h2>
                    <button id="meibot-modal-close" class="mobile-modal-close" aria-label="Close">&times;</button>
                </div>
                <div id="meibot-modal-chat" class="meibot-chat"></div>
                <form id="meibot-modal-form" class="meibot-form">
                    <input id="meibot-modal-input" type="text" placeholder="Ask me anything..." />
                    <button type="submit" class="small-tmr-btn">Send</button>
                </form>
            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="page-transitions.js?v=20260106a" defer></script>
    <script src="auth-client.js?v=20260106a"></script>
    <script src="theme-video.js?v=20260106a"></script>
    <script src="TMR.js?v=20260108a"></script>
    <script src="calendar.js?v=20260120b"></script>
    <script src="calendar-mobile.js?v=20260121c"></script>
    <script src="google-calendar-client.js?v=20260106a"></script>
    <script src="meibot.js?v=20260108a"></script>

    <!-- New Layout Logic Script -->
    <script>
        (function() {
            // Tutorial button in dropdown
            const tutorialBtn = document.getElementById('tutorial-btn');
            if (tutorialBtn) {
                tutorialBtn.addEventListener('click', () => {
                    window.location.href = 'intro.html';
                });
            }

            // Mobile tab switching
            const calendarBtn = document.getElementById('calendar-btn-mobile');
            const todoBtn = document.getElementById('todo-btn-mobile');
            const meiBtn = document.getElementById('meibot-btn-mobile');
            const calendarSection = document.querySelector('.calendar-section');
            const todoBackdrop = document.getElementById('todo-modal-backdrop');
            const meiModal = document.getElementById('meibot-modal');

            function switchTab(tabName) {
                // Remove active class from all buttons
                if (calendarBtn) calendarBtn.classList.remove('active');
                if (todoBtn) todoBtn.classList.remove('active');
                if (meiBtn) meiBtn.classList.remove('active');

                // Remove active class from all content
                if (calendarSection) calendarSection.classList.remove('active');
                if (todoBackdrop) todoBackdrop.classList.remove('active');
                if (meiModal) meiModal.classList.remove('active');

                // Add active class to selected tab
                if (tabName === 'calendar') {
                    if (calendarBtn) calendarBtn.classList.add('active');
                    if (calendarSection) calendarSection.classList.add('active');
                } else if (tabName === 'todo') {
                    if (todoBtn) todoBtn.classList.add('active');
                    if (todoBackdrop) todoBackdrop.classList.add('active');
                } else if (tabName === 'meibot') {
                    if (meiBtn) meiBtn.classList.add('active');
                    if (meiModal) meiModal.classList.add('active');
                }
            }

            if (calendarBtn) {
                calendarBtn.addEventListener('click', () => switchTab('calendar'));
            }

            if (todoBtn) {
                todoBtn.addEventListener('click', () => switchTab('todo'));
            }

            if (meiBtn) {
                meiBtn.addEventListener('click', () => switchTab('meibot'));
            }

            // Close button for meibot modal (mobile)
            const meibotCloseBtn = document.getElementById('meibot-modal-close');
            if (meibotCloseBtn) {
                meibotCloseBtn.addEventListener('click', () => switchTab('calendar'));
            }

            // Initialize with calendar tab active
            switchTab('calendar');
        })();
    </script>

    <script>
        // Debug: Check modal positioning
        window.addEventListener('load', () => {
            const meibot = document.getElementById('meibot-modal');
            const todoBackdrop = document.getElementById('todo-modal-backdrop');
            if (meibot) {
                const meiStyle = window.getComputedStyle(meibot);
                console.log('[DEBUG] Meibot Modal Computed Styles:');
                console.log('  position:', meiStyle.position);
                console.log('  top:', meiStyle.top);
                console.log('  left:', meiStyle.left);
                console.log('  right:', meiStyle.right);
                console.log('  bottom:', meiStyle.bottom);
                console.log('  display:', meiStyle.display);
                console.log('  opacity:', meiStyle.opacity);
                console.log('  padding-top:', meiStyle.paddingTop);
                console.log('  height:', meiStyle.height);
                console.log('  width:', meiStyle.width);
                console.log('  overflow:', meiStyle.overflow);
            }
        });
    </script>

    <!-- THEMES MODAL -->
    <div id="themes-modal-backdrop" class="themes-modal-backdrop" style="display: none;">
        <div class="themes-modal">
            <div class="themes-modal-header">
                <h2>Theme Settings</h2>
                <button id="themes-modal-close" class="themes-close" type="button">&times;</button>
            </div>
            <div class="themes-modal-content">
                <!-- Accent Color Section -->
                <div class="themes-section">
                    <label for="accent-picker">Accent Color</label>
                    <div class="accent-picker-row">
                        <input id="accent-picker" type="color" value="#0089f1" title="Choose accent color" />
                        <div id="accent-preview" class="color-preview" style="background-color: #0089f1;"></div>
                    </div>
                </div>

                <!-- Font Section -->
                <div class="themes-section">
                    <label for="font-picker">Font Family</label>
                    <select id="font-picker" title="Choose font family">
                        <option value="'Product Sans', 'Roboto', system-ui, -apple-system, sans-serif">Product Sans (Default)</option>
                        <option value="'Courier New', 'Courier', monospace">Courier New</option>
                        <option value="'Georgia', serif">Georgia</option>
                        <option value="'Times New Roman', 'Times', serif">Times New Roman</option>
                        <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
                        <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                        <option value="'Arial', sans-serif">Arial</option>
                        <option value="'Verdana', sans-serif">Verdana</option>
                        <option value="'Impact', fantasy">Impact</option>
                        <option value="'Lucida Console', monospace">Lucida Console</option>
                    </select>
                    <div id="font-preview" class="font-preview">The quick brown fox jumps over the lazy dog</div>

                    <label class="bold-toggle-label" style="display:flex;align-items:center;gap:10px;margin-top:10px;cursor:pointer;user-select:none;">
                        <input id="bold-toggle" type="checkbox" style="width:18px;height:18px;" />
                        <span>Bold Text</span>
                    </label>
                </div>

                <!-- Background Image Section -->
                <div class="themes-section">
                    <label for="bg-image-upload">Background Image</label>
                    <div class="bg-upload-row">
                        <input id="bg-image-upload" type="file" accept="image/*" />
                        <button id="bg-image-clear-btn" type="button" class="themes-btn-secondary">Clear</button>
                    </div>
                    <div id="bg-image-preview-container" class="bg-preview-container" style="display: none;">
                        <img id="bg-image-preview" src="" alt="Background preview" />
                    </div>
                    <div id="bg-image-none-text" class="bg-none-text">No image uploaded</div>
                </div>

                <!-- Background Video Section -->
                <div class="themes-section">
                    <label for="bg-video-upload">Background Video</label>
                    <div class="bg-upload-row">
                        <input id="bg-video-upload" type="file" accept="video/*" />
                        <button id="bg-video-clear-btn" type="button" class="themes-btn-secondary">Clear</button>
                    </div>
                    <div id="bg-video-preview-container" class="bg-preview-container" style="display: none;">
                        <video id="bg-video-preview" muted loop playsinline style="width:100%;height:100%;object-fit:cover;"></video>
                    </div>
                    <div id="bg-video-none-text" class="bg-none-text">No video uploaded</div>
                </div>

            </div>
            <div class="themes-modal-footer">
                <button id="themes-close-btn" type="button" class="themes-btn-secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- AUTH MODAL (LOGIN/REGISTER) -->
    <div id="auth-modal-backdrop" class="auth-modal-backdrop" style="display: none;">
        <div class="auth-modal">
            <!-- LOGIN FORM -->
            <form id="auth-login-form" class="auth-form">
                <h2>Welcome Back</h2>
                <p>Sign in to your TMR account</p>
                
                <div class="auth-form-group">
                    <label for="auth-login-username">Username</label>
                    <input id="auth-login-username" type="text" placeholder="Enter your username" required />
                </div>
                
                <div class="auth-form-group">
                    <label for="auth-login-password">Password</label>
                    <input id="auth-login-password" type="password" placeholder="Enter your password" required />
                </div>
                
                <div id="auth-login-error" class="auth-error"></div>
                
                <button type="submit" class="auth-submit-btn">Sign In</button>
                
                <div class="auth-divider">or</div>
                
                <p class="auth-toggle-text">
                    Don't have an account? 
                    <a id="auth-to-register-link" href="#">Create one</a>
                </p>
            </form>

            <!-- REGISTER FORM -->
            <form id="auth-register-form" class="auth-form" style="display: none;">
                <h2>Create Account</h2>
                <p>Join TMR to manage your schedule</p>
                
                <div class="auth-form-group">
                    <label for="auth-register-username">Username</label>
                    <input id="auth-register-username" type="text" placeholder="Choose a username" required />
                    <small>3-40 characters</small>
                </div>
                
                <div class="auth-form-group">
                    <label for="auth-register-password">Password</label>
                    <input id="auth-register-password" type="password" placeholder="Enter a password" required />
                    <small>At least 8 characters</small>
                </div>
                
                <div class="auth-form-group">
                    <label for="auth-register-confirm-password">Confirm Password</label>
                    <input id="auth-register-confirm-password" type="password" placeholder="Confirm your password" required />
                </div>
                
                <div id="auth-register-error" class="auth-error"></div>
                
                <button type="submit" class="auth-submit-btn">Create Account</button>
                
                <div class="auth-divider">or</div>
                
                <p class="auth-toggle-text">
                    Already have an account? 
                    <a id="auth-to-login-link" href="#">Sign in</a>
                </p>
            </form>
        </div>
    </div>

    <!-- AUTH STYLES -->
    <style>
        /* Base styles for auth flow */
        .calendar-page {
            display: flex !important;
        }

        .auth-modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            font-family: var(--font-family, 'Product Sans', 'Roboto', system-ui, -apple-system, sans-serif);
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }

        .auth-modal {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            width: 100%;
            max-width: 420px;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-form h2 {
            margin: 0 0 8px 0;
            font-size: 28px;
            font-weight: 700;
            color: #1a202c;
        }

        .auth-form > p {
            margin: 0 0 24px 0;
            color: #718096;
            font-size: 14px;
        }

        .auth-form-group {
            margin-bottom: 20px;
        }

        .auth-form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
        }

        .auth-form-group small {
            display: block;
            margin-top: 4px;
            font-size: 12px;
            color: #718096;
        }

        .auth-form-group input {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            box-sizing: border-box;
            transition: all 0.2s ease;
        }

        .auth-form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: #f7fafc;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .auth-form-group input::placeholder {
            color: #cbd5e0;
        }

        .auth-error {
            margin-bottom: 16px;
            padding: 12px;
            background: #fed7d7;
            color: #c53030;
            border-radius: 8px;
            font-size: 13px;
            display: none;
        }

        .auth-error:not(:empty) {
            display: block;
        }

        .auth-submit-btn {
            width: 100%;
            padding: 12px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-bottom: 16px;
        }

        .auth-submit-btn:hover {
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            transform: translateY(-2px);
        }

        .auth-submit-btn:active {
            transform: translateY(0);
        }

        .auth-divider {
            text-align: center;
            margin: 16px 0;
            color: #cbd5e0;
            font-size: 13px;
            font-weight: 500;
        }

        .auth-toggle-text {
            text-align: center;
            font-size: 13px;
            color: #718096;
            margin: 0;
        }

        .auth-toggle-text a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.2s ease;
        }

        .auth-toggle-text a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        @media (max-width: 480px) {
            .auth-modal {
                margin: 16px;
                padding: 32px 24px;
            }

            .auth-form h2 {
                font-size: 24px;
            }
        }
    </style>

</body>
</html>
