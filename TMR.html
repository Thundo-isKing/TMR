<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TMR - Calendar</title>
    <link rel="stylesheet" href="TMR.css?v=20251231z">
    <link rel="stylesheet" href="backgrounds.css?v=20251208a">
    <link rel="stylesheet" href="calendar-mobile.css?v=20251208b">
    <style>
        @media (min-width: 1025px) {
            body {
                display: flex;
                flex-direction: column;
                height: 100vh;
                overflow: visible !important;
            }

            .calendar-page {
                display: flex;
                flex-direction: row;
                min-height: 100vh;
                gap: 12px;
                padding: 12px;
                padding-right: 250px;
                align-items: center;
                justify-content: flex-start;
                overflow: visible !important;
                width: calc(100vw - 100px);
            }

            /* TODO Panel on LEFT - modal-sized (420px) */
            .todo-panel {
                flex: 0 0 420px;
                background: rgba(255, 255, 255, 0.5);
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                border-radius: 12px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                display: flex;
                flex-direction: column;
                height: 60vh;
                max-height: calc(100vh - 24px);
                overflow: hidden;
                margin-left: 15px;
            }

            .todo-panel h3 {
                margin: 0;
                padding: 16px;
                font-size: 18px;
                font-weight: 600;
                background: var(--accent-color, #0089f1);
                color: white;
                border-radius: 12px 12px 0 0;
                flex-shrink: 0;
            }

            .todo-panel .todo-input-row {
                padding: 16px;
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
                background: white;
                flex-shrink: 0;
                border-bottom: 1px solid #eee;
            }

            .todo-panel input[type="text"],
            .todo-panel input[type="number"] {
                flex: 1;
                min-width: 150px;
                padding: 10px 12px;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                font-size: 14px;
                transition: border-color 0.2s ease;
            }

            .todo-panel input:focus {
                outline: none;
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 0 0 3px rgba(0,137,241,0.15);
            }

            .todo-panel .todo-list {
                flex: 1;
                overflow-y: auto;
                list-style: none;
                padding: 0 16px 16px 16px;
                margin: 0;
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .todo-panel .todo-item {
                background: linear-gradient(135deg, #f8f9fa, #f0f3f7);
                border: 1px solid #e0e8f0;
                padding: 12px;
                border-radius: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                transition: all 0.2s ease;
            }

            .todo-panel .todo-item:hover {
                background: linear-gradient(135deg, #f0f3f7, #e8ecf2);
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 2px 8px rgba(0,137,241,0.1);
            }

            .todo-panel .small-tmr-btn {
                background: #d7dbdf !important;
                border: none !important;
                color: #333 !important;
                padding: 8px 14px !important;
                border-radius: 8px !important;
                box-shadow: none !important;
                transition: background 0.15s ease !important;
                transform: none !important;
            }

            .todo-panel .small-tmr-btn:hover {
                background: var(--accent-color, #0089f1) !important;
                transform: none !important;
                box-shadow: none !important;
            }

            /* MEIBOT Panel on RIGHT - modal-sized (400px) */
            .meibot-panel {
                flex: 0 0 400px;
                background: rgba(255, 255, 255, 0.5) !important;
                backdrop-filter: blur(12px) !important;
                -webkit-backdrop-filter: blur(12px) !important;
                border-radius: 16px;
                box-shadow: 0 8px 32px rgba(0,0,0,0.12);
                display: flex;
                flex-direction: column;
                height: 60vh;
                max-height: calc(100vh - 24px);
                overflow: hidden;
            }

            .meibot-panel h3 {
                margin: 0;
                padding: 20px;
                font-size: 20px;
                font-weight: 700;
                background: var(--accent-color, #0089f1);
                color: white;
                border-radius: 16px 16px 0 0;
                flex-shrink: 0;
                letter-spacing: 0.3px;
            }

            .meibot-panel #meibot-chat {
                flex: 1;
                overflow-y: auto;
                padding: 16px;
                display: flex;
                flex-direction: column;
                gap: 12px;
                background: transparent;
            }

            .meibot-message {
                display: flex;
                gap: 8px;
                margin-bottom: 4px;
                align-items: flex-end;
            }

            .meibot-message.user {
                justify-content: flex-end;
            }

            .meibot-message-text {
                max-width: 80%;
                padding: 12px 16px;
                border-radius: 12px;
                word-wrap: break-word;
                font-size: 14px;
                line-height: 1.4;
                box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            }

            .meibot-message.user .meibot-message-text {
                background: linear-gradient(135deg, var(--accent-color, #0089f1), var(--accent-hover, #0073d1));
                color: white;
                border-radius: 12px 4px 12px 12px;
                font-weight: 500;
            }

            .meibot-message.meibot .meibot-message-text {
                background: white;
                color: #333;
                border-radius: 4px 12px 12px 12px;
                border: 1px solid #e8e8e8;
            }

            .meibot-panel #meibot-form {
                padding: 16px;
                border-top: 1px solid #e8e8e8;
                display: flex;
                gap: 10px;
                flex-wrap: nowrap;
                flex-shrink: 0;
                background: transparent;
            }

            .meibot-panel #meibot-input {
                flex: 1;
                min-width: 120px;
                padding: 12px 16px;
                border: 1.5px solid #e0e0e0;
                border-radius: 10px;
                font-size: 14px;
                background: white;
                transition: all 0.2s ease;
                font-family: inherit;
            }

            .meibot-panel #meibot-input::placeholder {
                color: #999;
            }

            .meibot-panel #meibot-input:focus {
                outline: none;
                border-color: var(--accent-color, #0089f1);
                background: white;
                box-shadow: 0 0 0 3px rgba(0,137,241,0.1);
            }

            .meibot-panel .small-tmr-btn {
                padding: 12px 20px;
                background: var(--accent-color, #0089f1);
                color: white;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 600;
                transition: all 0.2s ease;
                white-space: nowrap;
                flex-shrink: 0;
                box-shadow: 0 2px 8px rgba(0,137,241,0.2);
            }

            .meibot-panel .small-tmr-btn:hover {
                background: var(--accent-hover, #0073d1);
                box-shadow: 0 4px 12px rgba(0,137,241,0.3);
                transform: translateY(-1px);
            }

            .meibot-panel .small-tmr-btn:active {
                transform: translateY(0);
                box-shadow: 0 1px 4px rgba(0,137,241,0.2);
            }

            /* Calendar Section in CENTER */
            .calendar-section {
                flex: 0 0 820px;
                overflow-y: auto;
                overflow-x: hidden;
                background: transparent;
                border-radius: 0;
                box-shadow: none;
                height: 60vh;
                max-height: calc(100vh - 24px);
            }

            /* Hide panels-container (we're using new layout) */
            .panels-container {
                display: none !important;
            }

            /* Hide mobile buttons on desktop */
            .calendar-buttons {
                display: none;
            }

            /* Hide modals on desktop (panels always visible) */
            #todo-modal-backdrop, #meibot-modal {
                display: none !important;
            }
        }

        /* ===== Mobile Landscape (ANY landscape orientation) ===== */
        @media (max-width: 1024px) and (orientation: landscape) {
            body {
                display: flex;
                flex-direction: row;
                height: 100vh;
                overflow: hidden;
            }

            .calendar-page {
                display: flex;
                flex-direction: row;
                width: 100%;
                height: 100%;
                position: relative;
                gap: 0;
            }

            /* Hide desktop panels on mobile */
            .todo-panel, .meibot-panel {
                display: none !important;
            }

            /* Hide desktop calendar and show mobile calendar */
            #calendar-app {
                display: none !important;
            }

            #mobile-calendar-container {
                display: flex !important;
                flex: 1;
                min-width: 0;
            }

            /* Buttons on RIGHT side in landscape - FIXED POSITION */
            .calendar-buttons {
                position: fixed !important;
                top: 75px !important;
                right: 568px !important;
                bottom: 8px !important;
                width: 55px;
                height: calc(100% - 78px);
                gap: 0;
                padding: 0;
                margin: 0;
                border-left: none;
                background: transparent;
                flex-shrink: 0;
                align-items: stretch;
                display: flex;
                flex-direction: column;
                z-index: 200;
                border-radius: 12px 0 0 12px;
            }

            .calendar-buttons button {
                flex: 1;
                width: 42px;
                padding: 0;
                border: none !important;
                border-radius: 12px;
                background: var(--accent-color, #0089f1) !important;
                color: white !important;
                font-size: 12px;
                font-weight: 500;
                cursor: pointer;
                writing-mode: vertical-rl;
                text-orientation: mixed;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: none !important;
                transform: none !important;
                transition: none !important;
            }

            .calendar-buttons button:hover:not(.active) {
                background: color-mix(in srgb, var(--accent-color, #0089f1) 70%, black) !important;
                transform: none !important;
                box-shadow: none !important;
            }

            .calendar-buttons button.active {
                background: var(--accent-color, #0089f1) !important;
                border: none !important;
                color: white !important;
                font-weight: 600;
                transform: none !important;
                box-shadow: none !important;
            }

            .calendar-buttons button.active:hover {
                background: color-mix(in srgb, var(--accent-color, #0089f1) 70%, black) !important;
                transform: none !important;
                box-shadow: none !important;
            }

            /* Calendar section with rounded left corner */
            .calendar-section {
                position: fixed !important;
                top: 75px !important;
                left: 8px !important;
                bottom: 13px !important;
                right: 618px !important;
                width: calc(100% - 626px);
                height: calc(100% - 88px);
                overflow: hidden;
                border-radius: 12px 0 0 12px;
            }

            /* Todo and Meibot modals with square right edge to blend with button left edges */
            #todo-modal-backdrop,
            #meibot-modal {
                position: fixed !important;
                top: 75px !important;
                left: 8px !important;
                bottom: 13px !important;
                right: 618px !important;
                width: calc(100% - 626px);
                height: calc(100% - 88px);
                overflow: hidden;
                border-radius: 12px !important;
            }

            /* Calendar section visibility */
            .calendar-section {
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex;
                flex-direction: column;
                z-index: 50;
            }

            .calendar-section.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            /* Modals overlay on calendar space */
            #todo-modal-backdrop {
                background: none !important;
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex !important;
                flex-direction: column !important;
                z-index: 100;
            }

            #todo-modal-backdrop.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            #meibot-modal {
                background: none !important;
                overflow: hidden !important;
                flex-direction: column !important;
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex !important;
                z-index: 100;
            }

            #meibot-modal.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            /* TODO MODAL - full screen in landscape */
            .todo-modal {
                background: white;
                border: none;
                box-shadow: none;
                height: auto;
                max-height: calc(100vh - 150px);
                width: 100%;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                border-radius: 12px !important;
                margin: 0;
                padding: 0;
            }

            .todo-modal .todo-banner {
                margin: 0;
                padding: 16px;
                background: var(--accent-color, #0089f1);
                color: white;
                display: flex;
                align-items: center;
                flex-shrink: 0;
                border-radius: 12px 12px 0 0;
            }

            .todo-modal .todo-banner h3 {
                margin: 0;
                padding: 0;
                color: white;
                font-size: 18px;
                font-weight: 600;
            }

            .todo-modal .todo-input-row {
                padding: 16px;
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
                background: white;
                flex-shrink: 0;
                border-bottom: 1px solid #eee;
            }

            .todo-modal input[type="text"],
            .todo-modal input[type="number"] {
                flex: 1;
                min-width: 150px;
                padding: 10px 12px;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                font-size: 14px;
                transition: border-color 0.2s ease;
            }

            .todo-modal input:focus {
                outline: none;
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 0 0 3px rgba(0,137,241,0.15);
            }

            .todo-modal .todo-list {
                max-height: 70vh;
                overflow-y: auto;
                list-style: none;
                padding: 16px;
                margin: 0;
                display: flex;
                flex-direction: column;
                gap: 8px;
                flex: 1;
            }

            .todo-modal .todo-item {
                background: linear-gradient(135deg, #f8f9fa, #f0f3f7);
                border: 1px solid #e0e8f0;
                padding: 12px;
                border-radius: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 8px;
                transition: all 0.2s ease;
            }

            .todo-modal .todo-item:hover {
                background: linear-gradient(135deg, #f0f3f7, #e8ecf2);
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 2px 8px rgba(0,137,241,0.1);
            }

            .todo-modal .small-tmr-btn {
                background: #d7dbdf !important;
                border: none !important;
                color: #333 !important;
                padding: 8px 14px !important;
                border-radius: 8px !important;
                box-shadow: none !important;
                transition: background 0.15s ease !important;\
                transform: none !important;
                transform: none !important;
            }

            /* MEIBOT MODAL - full screen in landscape */
            .meibot-modal-content {
                height: 100%;
                width: 100%;
                display: flex;
                flex-direction: column;
                background: white;
                overflow: hidden;
                border-radius: 12px;
                margin: 0;
            }

            .meibot-header {
                margin: 0;
                padding: 8px 16px;
                font-size: 16px;
                font-weight: 600;
                background: var(--accent-color, #0089f1);
                color: white;
                flex-shrink: 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .meibot-chat {
                flex: 1;
                overflow-y: auto;
                padding: 12px;
                background: white;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            #meibot-modal-form {
                padding: 10px 12px;
                border-top: 1px solid #eee;
                display: flex;
                gap: 6px;
                flex-wrap: wrap;
                flex-shrink: 0;
                background: white;
            }

            #meibot-modal-input {
                flex: 1;
                min-width: 150px;
                padding: 8px 10px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 13px;
            }
        }

        @media (max-width: 1024px) and (orientation: portrait) {
            body {
                display: flex;
                flex-direction: column;
                height: 100vh;
                overflow: hidden;
            }

            .calendar-page {
                display: flex;
                flex-direction: column;
                width: 100%;
                height: 100%;
                position: relative;
                overflow: hidden;
            }

            /* Hide desktop panels on mobile */
            .todo-panel, .meibot-panel {
                display: none !important;
            }

            /* Hide desktop calendar and show mobile calendar */
            #calendar-app {
                display: none !important;
            }

            #mobile-calendar-container {
                display: flex !important;
                flex: 1;
                min-width: 0;
            }

            /* Buttons on TOP in portrait (like tabs) - FIXED POSITION */
            .calendar-buttons {
                position: fixed !important;
                top: 75px !important;
                left: 8px !important;
                right: 8px !important;
                height: 50px;
                width: calc(100% - 16px);
                gap: 0;
                padding: 0;
                margin: 0;
                border-bottom: none;
                background: transparent;
                flex-shrink: 0;
                align-items: center;
                display: flex;
                flex-direction: row;
                z-index: 200;
                border-radius: 12px 12px 0 0;
            }

            .calendar-buttons button {
                flex: 1;
                height: 50px;
                padding: 0;
                border: none !important;
                border-radius: 12px;
                background: var(--accent-color, #0089f1) !important;
                color: white !important;
                font-size: 10px;
                font-weight: 500;
                cursor: pointer;
                position: relative;
                bottom: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: none !important;
                transform: none !important;
                transition: none !important;
            }

            .calendar-buttons button:hover:not(.active) {
                background: color-mix(in srgb, var(--accent-color, #0089f1) 70%, black) !important;
                transform: none !important;
                box-shadow: none !important;
            }

            .calendar-buttons button.active {
                background: var(--accent-color, #0089f1) !important;
                border: none !important;
                color: white !important;
                font-weight: 600;
                bottom: 0;
                transform: none !important;
                box-shadow: none !important;
            }

            .calendar-buttons button.active:hover {
                background: color-mix(in srgb, var(--accent-color, #0089f1) 70%, black) !important;
                transform: none !important;
                box-shadow: none !important;
            }

            /* Calendar section with rounded bottom */
            .calendar-section {
                position: fixed !important;
                top: 130px !important;
                left: 8px !important;
                right: 8px !important;
                bottom: 0 !important;
                width: calc(100% - 16px);
                overflow: hidden;
                border-radius: 0 0 12px 12px;
            }

            /* Todo and Meibot modals with square edges to blend with button bottoms */
            #todo-modal-backdrop,
            #meibot-modal {
                position: fixed !important;
                top: 75px !important;
                left: 8px !important;
                right: 8px !important;
                width: calc(100% - 16px);
                overflow: hidden;
                border-radius: 12px !important;
                height: auto;
            }

            /* Calendar section visibility */
            .calendar-section {
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex;
                flex-direction: column;
                z-index: 50;
            }

            .calendar-section.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            /* Modals overlay on calendar space */
            #todo-modal-backdrop {
                background: none !important;
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex !important;
                flex-direction: column !important;
                z-index: 100;
            }

            #todo-modal-backdrop.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            #meibot-modal {
                background: none !important;
                overflow: hidden !important;
                flex-direction: column !important;
                opacity: 0 !important;
                pointer-events: none !important;
                transition: opacity 0.3s ease;
                display: flex !important;
                z-index: 100;
            }

            #meibot-modal.active {
                opacity: 1 !important;
                pointer-events: auto !important;
            }

            /* TODO MODAL - full screen in portrait */
            .todo-modal {
                background: white;
                border: none;
                box-shadow: none;
                height: auto;
                max-height: calc(100vh - 200px);
                width: 100%;
                overflow-y: auto;
                display: flex;
                flex-direction: column;
                border-radius: 12px !important;
                margin: 0;
                padding: 0;
            }

            .todo-modal .todo-banner {
                margin: 0;
                padding: 16px;
                background: var(--accent-color, #0089f1);
                color: white;
                display: flex;
                align-items: center;
                flex-shrink: 0;
                border-radius: 12px 12px 0 0;
            }

            .todo-modal .todo-banner h3 {
                margin: 0;
                padding: 0;
                color: white;
                font-size: 18px;
                font-weight: 600;
            }

            .todo-modal .todo-input-row {
                padding: 16px;
                display: flex;
                gap: 8px;
                flex-wrap: wrap;
                background: white;
                flex-shrink: 0;
                border-bottom: 1px solid #eee;
            }

            .todo-modal input[type="text"],
            .todo-modal input[type="number"] {
                flex: 1;
                min-width: 150px;
                padding: 10px 12px;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                font-size: 14px;
                transition: border-color 0.2s ease;
            }

            .todo-modal input:focus {
                outline: none;
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 0 0 3px rgba(0,137,241,0.15);
            }

            .todo-modal .todo-list {
                max-height: 70vh;
                overflow-y: auto;
                list-style: none;
                padding: 16px;
                margin: 0;
                display: flex;
                flex-direction: column;
                gap: 8px;
                flex: 1;
            }

            .todo-modal .todo-item {
                background: linear-gradient(135deg, #f8f9fa, #f0f3f7);
                border: 1px solid #e0e8f0;
                padding: 12px;
                border-radius: 8px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 8px;
                transition: all 0.2s ease;
            }

            .todo-modal .todo-item:hover {
                background: linear-gradient(135deg, #f0f3f7, #e8ecf2);
                border-color: var(--accent-color, #0089f1);
                box-shadow: 0 2px 8px rgba(0,137,241,0.1);
            }

            .todo-modal .small-tmr-btn {
                background: #d7dbdf !important;
                border: none !important;
                color: #333 !important;
                padding: 8px 14px !important;
                border-radius: 8px !important;
                box-shadow: none !important;
                transition: background 0.15s ease !important;
                transform: none !important;
            }

            /* MEIBOT MODAL - full screen in portrait */
            .meibot-modal-content {
                height: 100%;
                width: 100%;
                display: flex;
                flex-direction: column;
                background: white;
                overflow: hidden;
                border-radius: 12px;
                margin: 0;
            }

            .meibot-header {
                margin: 0;
                padding: 8px 16px;
                font-size: 16px;
                font-weight: 600;
                background: var(--accent-color, #0089f1);
                color: white;
                flex-shrink: 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .meibot-chat {
                flex: 1;
                overflow-y: auto;
                padding: 12px;
                background: white;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            #meibot-modal-form {
                padding: 10px 12px;
                border-top: 1px solid #eee;
                display: flex;
                gap: 6px;
                flex-wrap: wrap;
                flex-shrink: 0;
                background: white;
            }

            #meibot-modal-input {
                flex: 1;
                min-width: 150px;
                padding: 8px 10px;
                border: 1px solid #ddd;
                border-radius: 4px;
                font-size: 13px;
            }
        }

        /* ===== Base Styles for New Layout ===== */
        .calendar-page {
            width: 100%;
        }

        .todo-panel, .meibot-panel {
            position: relative;
        }

        /* Ensure modals display as flex when shown */
        #todo-modal-backdrop.shown,
        #meibot-modal.shown {
            display: flex !important;
        }

        .todo-modal-backdrop.shown {
            display: flex !important;
        }
    </style>
</head>

<body class="page-background triangle-background currentschedules-page">

    <!-- PAGE HEADER (Desktop only) -->
    <header class="page-header">
        <!-- Left: TMR Button + Settings Menu -->
        <div class="header-left">
            <button id="tmr-header-btn" class="header-text-btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
                TMR
                <svg class="gear-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m2.98 2.98l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m2.98-2.98l4.24-4.24M19.78 19.78l-4.24-4.24m-2.98-2.98l-4.24-4.24"></path>
                </svg>
            </button>
            <div id="tmr-header-menu" class="tmr-menu" hidden>
            <div class="tmr-menu-item">
                <label>
                    <input id="notify-toggle" type="checkbox" /> Enable notifications
                </label>
            </div>
            <div class="tmr-menu-item">
                <label for="notify-mode">Notification mode
                    <select id="notify-mode" style="margin-left:8px;">
                        <option value="both">Local + Server (default)</option>
                        <option value="local">Local only</option>
                        <option value="server">Server only</option>
                    </select>
                </label>
            </div>
            <div class="tmr-menu-item">
                <label for="todo-default-reminder">Default todo reminder (minutes)
                    <input id="todo-default-reminder" type="number" min="0" value="10" title="Default minutes before reminder">
                </label>
            </div>
            <div class="tmr-menu-item">
                <button id="notify-test-btn" class="small-tmr-btn" type="button">Test notification</button>
            </div>
            <div class="tmr-menu-item">
                <label>
                    <input id="push-enable" type="checkbox" /> Enable background push (Service Worker)
                </label>
                <div style="margin-top:6px;">
                    <input id="vapid-public-input" placeholder="VAPID public key (optional)" style="width:100%" />
                    <button id="push-subscribe-btn" class="small-tmr-btn" type="button" style="margin-top:6px;">Subscribe for push</button>
                    <button id="manage-subs-btn" class="small-tmr-btn" type="button" style="margin-top:6px;margin-left:6px;">Manage subscriptions</button>
                </div>
            </div>
            <div class="tmr-menu-item" style="border-top:1px solid #ccc; padding-top:8px; margin-top:8px;">
                <button id="tutorial-btn" class="small-tmr-btn" type="button">View Tutorial</button>
            </div>
            <div class="tmr-menu-item">
                <button id="export-data-btn" class="small-tmr-btn" type="button">Export data</button>
                <button id="import-data-btn" class="small-tmr-btn" type="button" style="margin-top:6px;">Import data</button>
                <input id="import-file-input" type="file" accept=".json" hidden />
            </div>
            <div class="tmr-menu-item">
                <button id="fullscreen-btn-tmr" type="button" class="small-tmr-btn">Fullscreen</button>
            </div>
        </div>
        </div>
        
        <!-- Center: Search Bar -->
        <div class="header-center">
            <div class="search-container">
                <input id="header-search-input" type="text" placeholder="Search events, notes..." class="search-input" aria-label="Search">
                <button id="search-clear-btn" class="search-clear-btn" aria-label="Clear search" title="Clear search">✕</button>
                <div id="search-suggestions" class="search-suggestions" hidden></div>
            </div>
        </div>
        
        <!-- Right: Notes & Themes Buttons -->
        <div class="header-right">
            <button id="header-notes-btn" class="header-text-btn" tabindex="0">📝 Notes</button>
            <button id="header-themes-btn" class="header-text-btn" tabindex="0">🎨 Themes</button>
        </div>
    </header>

    <!-- Main Page Container -->
    <div class="calendar-page">

        <!-- Mobile Buttons Bar (visible only on mobile <1025px) -->
        <div class="calendar-buttons">
            <button id="calendar-btn-mobile" class="tmr-btn small-tmr-btn active">📅 Calendar</button>
            <button id="todo-btn-mobile" class="tmr-btn small-tmr-btn">✓ Todo</button>
            <button id="meibot-btn-mobile" class="tmr-btn small-tmr-btn">🤖 Meibot</button>
        </div>

        <!-- TODO PANEL (LEFT SIDE - Desktop only) -->
        <div class="todo-panel">
            <div class="todo-banner">
                <h3>To Do</h3>
            </div>
            <button id="desktop-create-todo-btn" class="small-tmr-btn" style="width: 100%; padding: 12px; margin-bottom: 12px; font-size: 16px;">+ Create Todo</button>
            <ul id="todo-list" class="todo-list" aria-live="polite"></ul>
        </div>

        <!-- Calendar Section (CENTER - visible on all devices) -->
        <div class="calendar-section">
            <!-- Calendar app -->
            <div id="calendar-app" class="calendar-app">
                <div class="calendar-header">
                    <div style="display:flex; align-items:center; gap:8px;">
                        <button id="prev-month" class="nav-btn tmr-btn small-tmr-btn">&lt;</button>
                        <div id="month-year" class="month-year"></div>
                        <button id="next-month" class="nav-btn tmr-btn small-tmr-btn">&gt;</button>
                    </div>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <button id="export-btn" class="nav-btn tmr-btn small-tmr-btn">Export</button>
                        <button id="import-btn" class="nav-btn tmr-btn small-tmr-btn">Import</button>
                        <input id="import-file" type="file" accept=".json" style="display:none">
                        <button id="gcal-auth-btn" class="nav-btn tmr-btn small-tmr-btn" title="Connect to Google Calendar">🔗 Google Calendar</button>
                        <button id="gcal-sync-btn" class="nav-btn tmr-btn small-tmr-btn" style="display:none;" title="Sync with Google Calendar">🔄 Sync</button>
                        <button id="gcal-logout-btn" class="nav-btn tmr-btn small-tmr-btn" style="display:none;" title="Disconnect Google Calendar">⛔ Disconnect</button>
                    </div>
                </div>
                <div id="weekday-row" class="weekday-row" aria-hidden="false"></div>
                <div id="calendar" class="calendar-grid" aria-label="Monthly calendar"></div>
            </div>

            <!-- Mobile Calendar Container (hidden on desktop) -->
            <div id="mobile-calendar-container">
                <div class="mobile-calendar-header">
                    <button id="mobile-prev-month" class="mobile-nav-btn">&lt;</button>
                    <div class="month-year"></div>
                    <button id="mobile-next-month" class="mobile-nav-btn">&gt;</button>
                    <button id="mobile-gcal-menu-btn" class="mobile-nav-btn" title="Google Calendar">🔗</button>
                </div>

                <div class="mobile-calendar-grid-container">
                    <div class="mobile-weekday-row" id="mobile-weekday-row"></div>
                    <div class="mobile-calendar-grid" id="mobile-calendar-grid"></div>
                </div>

                <!-- Clock (below calendar on mobile portrait) -->
                <div class="clock-container">
                    <div class="clock-outer-box">
                        <div class="clock-inner-box">
                            <div id="clock"></div>
                        </div>
                    </div>
                </div>

                <div id="mobile-modal-backdrop" class="mobile-modal-backdrop">
                    <div class="mobile-modal-content">
                        <div class="mobile-modal-header">
                            <span id="mobile-modal-title">Events</span>
                            <button id="mobile-modal-close" class="mobile-modal-close">&times;</button>
                        </div>
                        <div class="mobile-modal-body">
                            <div id="mobile-event-list" class="mobile-event-list"></div>
                            <form id="mobile-event-form" class="mobile-event-form">
                                <div class="mobile-form-group">
                                    <label>Title</label>
                                    <input id="mobile-event-title" type="text" required />
                                </div>
                                <div class="mobile-form-group">
                                    <label>Time</label>
                                    <input id="mobile-event-time" type="time" />
                                </div>
                                <div class="mobile-form-group">
                                    <label>Notes</label>
                                    <textarea id="mobile-event-notes" rows="3"></textarea>
                                </div>
                                <div class="mobile-form-group">
                                    <label>Color</label>
                                    <div class="mobile-color-picker">
                                        <button type="button" class="mobile-color-btn" data-color="#ff6b6b" title="Red" style="background: #ff6b6b;"></button>
                                        <button type="button" class="mobile-color-btn" data-color="#ff922b" title="Orange" style="background: #ff922b;"></button>
                                        <button type="button" class="mobile-color-btn" data-color="#ffd43b" title="Yellow" style="background: #ffd43b;"></button>
                                        <button type="button" class="mobile-color-btn" data-color="#51cf66" title="Green" style="background: #51cf66;"></button>
                                        <button type="button" class="mobile-color-btn" data-color="#0089f1" title="Blue" style="background: #0089f1;"></button>
                                        <button type="button" class="mobile-color-btn" data-color="#9775fa" title="Violet" style="background: #9775fa;"></button>
                                        <button type="button" class="mobile-color-btn" data-color="#1f1f1f" title="Black" style="background: #1f1f1f;"></button>
                                        <button type="button" class="mobile-color-btn" data-color="#999999" title="Grey" style="background: #999999;"></button>
                                        <button type="button" class="mobile-color-btn" data-color="#8B4513" title="Brown" style="background: #8B4513;"></button>
                                    </div>
                                </div>
                                <div class="mobile-form-actions">
                                    <button type="submit" class="mobile-save-btn">Save</button>
                                    <button type="button" id="mobile-delete-btn" class="mobile-delete-btn danger" style="display:none;">Delete</button>
                                    <button type="button" class="mobile-cancel-btn">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Google Calendar Modal (Mobile) -->
                <div id="gcal-mobile-modal-backdrop" class="gcal-mobile-modal-backdrop" style="display:none;">
                    <div class="gcal-mobile-modal">
                        <div class="gcal-mobile-modal-header">
                            <span>Google Calendar</span>
                            <button id="gcal-mobile-modal-close" class="gcal-mobile-modal-close">&times;</button>
                        </div>
                        <div class="gcal-mobile-modal-body">
                            <button id="mobile-gcal-auth-btn" class="mobile-gcal-modal-btn" title="Connect to Google Calendar" style="display:none;">🔗 Connect to Google Calendar</button>
                            <button id="mobile-gcal-sync-btn" class="mobile-gcal-modal-btn" title="Sync with Google Calendar" style="display:none;">🔄 Sync Calendar</button>
                            <button id="mobile-gcal-logout-btn" class="mobile-gcal-modal-btn danger" title="Disconnect Google Calendar" style="display:none;">⛔ Disconnect</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Day / event modal -->
            <div id="event-modal" class="modal hidden" aria-hidden="true">
                <div class="modal-content">
                    <button id="close-modal" class="modal-close" aria-label="Close">&times;</button>
                    <h3 id="modal-title">Add Event</h3>
                    <form id="event-form">
                        <input type="hidden" id="event-id">
                        <label>Title
                            <input id="event-title" required />
                        </label>
                        <label>Date
                            <input id="event-date" type="date" required />
                        </label>
                        <label>Time
                            <input id="event-time" type="time" />
                        </label>
                        <label>Notes
                            <textarea id="event-notes"></textarea>
                        </label>
                        <label>Color
                            <div id="color-picker" style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px;">
                                <button type="button" class="color-btn" data-color="#ff6b6b" title="Red" style="background: #ff6b6b; width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;"></button>
                                <button type="button" class="color-btn" data-color="#ff922b" title="Orange" style="background: #ff922b; width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;"></button>
                                <button type="button" class="color-btn" data-color="#ffd43b" title="Yellow" style="background: #ffd43b; width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;"></button>
                                <button type="button" class="color-btn" data-color="#51cf66" title="Green" style="background: #51cf66; width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;"></button>
                                <button type="button" class="color-btn" data-color="#0089f1" title="Blue" style="background: #0089f1; width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;"></button>
                                <button type="button" class="color-btn" data-color="#9775fa" title="Violet" style="background: #9775fa; width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;"></button>
                                <button type="button" class="color-btn" data-color="#1f1f1f" title="Black" style="background: #1f1f1f; width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;"></button>
                                <button type="button" class="color-btn" data-color="#999999" title="Grey" style="background: #999999; width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;"></button>
                                <button type="button" class="color-btn" data-color="#8B4513" title="Brown" style="background: #8B4513; width: 32px; height: 32px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;"></button>
                            </div>
                        </label>
                        <div class="modal-actions">
                            <button type="submit" id="save-event" class="tmr-btn">Save</button>
                            <button type="button" id="delete-event" class="tmr-btn danger">Delete</button>
                            <button type="button" id="cancel-event" class="tmr-btn">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Landscape mode clock container (separate from calendar) -->
            <div id="landscape-clock-container" class="landscape-clock-container">
                <div class="landscape-clock-outer-box">
                    <div class="landscape-clock-inner-box">
                        <div id="landscape-clock"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MEIBOT PANEL (RIGHT SIDE - Desktop only) -->
        <div class="meibot-panel" style="background: rgba(255, 255, 255, 0.5) !important;">
            <h3>Meibot</h3>
            <div id="meibot-chat" class="meibot-chat" role="log" aria-live="polite" aria-label="Chat messages"></div>
            <form id="meibot-form" class="meibot-form" role="search">
                <input id="meibot-input" type="text" placeholder="Ask Meibot..." aria-label="Message input" autocomplete="off" />
                <button type="submit" class="small-tmr-btn" aria-label="Send message">Send</button>
            </form>
        </div>

        <!-- TODO MODAL (for mobile) -->
        <div id="todo-modal-backdrop" class="todo-modal-backdrop">
            <div class="todo-modal" role="dialog" aria-modal="true" aria-labelledby="todo-modal-title">
                <div class="todo-banner">
                    <h3 id="todo-modal-title">To Do</h3>
                    <button id="todo-modal-create-btn" class="small-tmr-btn">+ Create Todo</button>
                </div>
                <ul id="todo-modal-list" class="todo-list"></ul>
            </div>
        </div>

        <!-- DESKTOP VIEW TODO MODAL -->
        <div id="todo-view-modal-backdrop" class="todo-modal-backdrop" style="display: none;">
            <div class="todo-modal" role="dialog" aria-modal="true" aria-labelledby="todo-view-modal-title">
                <h3 id="todo-view-modal-title">View Todo</h3>
                <div style="padding: 16px; background: #f9f9f9; border-radius: 8px;">
                    <div style="margin-bottom: 16px;">
                        <strong>Title:</strong>
                        <p id="todo-view-title" style="margin: 8px 0; font-size: 16px;"></p>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <strong>Notes:</strong>
                        <p id="todo-view-notes" style="margin: 8px 0; font-size: 14px; white-space: pre-wrap; color: #555;"></p>
                    </div>
                    <div style="display: flex; gap: 8px; justify-content: flex-end;">
                        <button id="todo-view-edit-btn" class="small-tmr-btn">Edit</button>
                        <button id="todo-view-close-btn" class="small-tmr-btn">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- DESKTOP CREATE/EDIT TODO MODAL -->
        <div id="todo-create-edit-modal-backdrop" class="todo-modal-backdrop" style="display: none;">
            <div class="todo-modal" role="dialog" aria-modal="true" aria-labelledby="todo-create-edit-modal-title" style="border-radius: 12px !important;">
                <h3 id="todo-create-edit-modal-title">Create Todo</h3>
                <div style="padding: 16px; display: flex; flex-direction: column; gap: 12px;">
                    <div>
                        <label for="todo-edit-title" style="display: block; font-weight: bold; margin-bottom: 4px;">Title *</label>
                        <input id="todo-edit-title" type="text" placeholder="Enter todo title..." style="width: 100%; padding: 10px 8px; border: 2px solid #e0e0e0; border-radius: 6px; box-sizing: border-box;" />
                    </div>
                    <div style="border-top: 1px solid #e0e0e0; padding-top: 12px;">
                        <label style="display: block; font-weight: bold; margin-bottom: 8px;">Reminder</label>
                        <div style="display: flex; gap: 6px; align-items: center; flex-wrap: wrap;">
                            <select id="todo-edit-reminder-type" style="padding: 10px 8px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                                <option value="none">No reminder</option>
                                <option value="minutes">In minutes</option>
                                <option value="time">At time</option>
                            </select>
                            <input id="todo-edit-reminder-minutes" type="number" min="0" placeholder="minutes" style="width: 80px; padding: 10px 8px; border: 2px solid #e0e0e0; border-radius: 6px; display: none;" />
                            <input id="todo-edit-reminder-time" type="time" style="padding: 10px 8px; border: 2px solid #e0e0e0; border-radius: 6px; display: none;" />
                        </div>
                    </div>
                    <div>
                        <label for="todo-edit-notes" style="display: block; font-weight: bold; margin-bottom: 4px;">Notes</label>
                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">
                            <button type="button" id="bullet-point-btn" class="small-tmr-btn" style="padding: 6px 12px; font-size: 14px;">• Bullet</button>
                            <button type="button" id="checkbox-marker-btn" class="small-tmr-btn" style="padding: 6px 12px; font-size: 14px;">☐ Checkbox</button>
                        </div>
                        <textarea id="todo-edit-notes" placeholder="Add detailed notes..." style="width: 100%; padding: 10px 8px; border: 2px solid #e0e0e0; border-radius: 6px; min-height: 100px; box-sizing: border-box; font-family: inherit;"></textarea>
                    </div>
                    <div style="border-top: 1px solid #e0e0e0; padding-top: 12px; display: flex; gap: 8px; justify-content: flex-end;">
                        <button id="todo-edit-save-btn" class="small-tmr-btn">Save</button>
                        <button id="todo-edit-cancel-btn" class="small-tmr-btn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MEIBOT MODAL (for mobile) -->
        <div id="meibot-modal" class="meibot-modal">
            <div class="meibot-modal-content">
                <div class="meibot-header">
                    <h2>Meibot</h2>
                    <button id="meibot-modal-close" class="meibot-close">&times;</button>
                </div>
                <div id="meibot-modal-chat" class="meibot-chat"></div>
                <form id="meibot-modal-form" class="meibot-form">
                    <input id="meibot-modal-input" type="text" placeholder="Ask me anything..." />
                    <button type="submit" class="tmr-btn small-tmr-btn">Send</button>
                </form>
            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="TMR.js"></script>
    <script src="calendar.js"></script>
    <script src="calendar-mobile.js"></script>
    <script src="google-calendar-client.js"></script>
    <script src="meibot.js"></script>

    <!-- New Layout Logic Script -->
    <script>
        (function() {
            // Check first visit
            const hasSeen = localStorage.getItem('tmr_tutorial_seen');
            if (!hasSeen) {
                window.location.href = 'intro.html';
                return;
            }

            // Tutorial button in dropdown
            const tutorialBtn = document.getElementById('tutorial-btn');
            if (tutorialBtn) {
                tutorialBtn.addEventListener('click', () => {
                    window.location.href = 'intro.html';
                });
            }

            // Mobile tab switching
            const calendarBtn = document.getElementById('calendar-btn-mobile');
            const todoBtn = document.getElementById('todo-btn-mobile');
            const meiBtn = document.getElementById('meibot-btn-mobile');
            const calendarSection = document.querySelector('.calendar-section');
            const todoBackdrop = document.getElementById('todo-modal-backdrop');
            const meiModal = document.getElementById('meibot-modal');

            function switchTab(tabName) {
                // Remove active class from all buttons
                if (calendarBtn) calendarBtn.classList.remove('active');
                if (todoBtn) todoBtn.classList.remove('active');
                if (meiBtn) meiBtn.classList.remove('active');

                // Remove active class from all content
                if (calendarSection) calendarSection.classList.remove('active');
                if (todoBackdrop) todoBackdrop.classList.remove('active');
                if (meiModal) meiModal.classList.remove('active');

                // Add active class to selected tab
                if (tabName === 'calendar') {
                    if (calendarBtn) calendarBtn.classList.add('active');
                    if (calendarSection) calendarSection.classList.add('active');
                } else if (tabName === 'todo') {
                    if (todoBtn) todoBtn.classList.add('active');
                    if (todoBackdrop) todoBackdrop.classList.add('active');
                } else if (tabName === 'meibot') {
                    if (meiBtn) meiBtn.classList.add('active');
                    if (meiModal) meiModal.classList.add('active');
                }
            }

            if (calendarBtn) {
                calendarBtn.addEventListener('click', () => switchTab('calendar'));
            }

            if (todoBtn) {
                todoBtn.addEventListener('click', () => switchTab('todo'));
            }

            if (meiBtn) {
                meiBtn.addEventListener('click', () => switchTab('meibot'));
            }

            // Close button for meibot modal (mobile)
            const meibotCloseBtn = document.getElementById('meibot-modal-close');
            if (meibotCloseBtn) {
                meibotCloseBtn.addEventListener('click', () => switchTab('calendar'));
            }

            // Initialize with calendar tab active
            switchTab('calendar');
        })();
    </script>

    <script>
        // Debug: Check modal positioning
        window.addEventListener('load', () => {
            const meibot = document.getElementById('meibot-modal');
            const todoBackdrop = document.getElementById('todo-modal-backdrop');
            if (meibot) {
                const meiStyle = window.getComputedStyle(meibot);
                console.log('[DEBUG] Meibot Modal Computed Styles:');
                console.log('  position:', meiStyle.position);
                console.log('  top:', meiStyle.top);
                console.log('  left:', meiStyle.left);
                console.log('  right:', meiStyle.right);
                console.log('  bottom:', meiStyle.bottom);
                console.log('  display:', meiStyle.display);
                console.log('  opacity:', meiStyle.opacity);
                console.log('  padding-top:', meiStyle.paddingTop);
                console.log('  height:', meiStyle.height);
                console.log('  width:', meiStyle.width);
                console.log('  overflow:', meiStyle.overflow);
            }
        });
    </script>

    <!-- THEMES MODAL -->
    <div id="themes-modal-backdrop" class="themes-modal-backdrop" style="display: none;">
        <div class="themes-modal">
            <div class="themes-modal-header">
                <h2>Theme Settings</h2>
                <button id="themes-modal-close" class="themes-close" type="button">&times;</button>
            </div>
            <div class="themes-modal-content">
                <!-- Accent Color Section -->
                <div class="themes-section">
                    <label for="accent-picker">Accent Color</label>
                    <div class="accent-picker-row">
                        <input id="accent-picker" type="color" value="#0089f1" title="Choose accent color" />
                        <div id="accent-preview" class="color-preview" style="background-color: #0089f1;"></div>
                    </div>
                </div>

                <!-- Background Image Section -->
                <div class="themes-section">
                    <label for="bg-image-upload">Background Image</label>
                    <div class="bg-upload-row">
                        <input id="bg-image-upload" type="file" accept="image/*" />
                        <button id="bg-image-clear-btn" type="button" class="themes-btn-secondary">Clear</button>
                    </div>
                    <div id="bg-image-preview-container" class="bg-preview-container" style="display: none;">
                        <img id="bg-image-preview" src="" alt="Background preview" />
                    </div>
                    <div id="bg-image-none-text" class="bg-none-text">No image uploaded</div>
            </div>
            <div class="themes-modal-footer">
                <button id="themes-close-btn" type="button" class="themes-btn-secondary">Close</button>
            </div>
        </div>
    </div>
</body>
</html>
